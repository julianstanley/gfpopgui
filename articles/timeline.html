<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GSOC 2020 Timeline Updates • gfpopgui</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GSOC 2020 Timeline Updates">
<meta property="og:description" content="gfpopgui">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gfpopgui</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/timeline.html">GSOC 2020 Timeline Updates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/julianstanley/gfpopgui/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="timeline_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GSOC 2020 Timeline Updates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/julianstanley/gfpopgui/blob/master/vignettes/timeline.Rmd"><code>vignettes/timeline.Rmd</code></a></small>
      <div class="hidden name"><code>timeline.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Hi! I will update this section of the website as I progress through Google Summer of Code (GSOC) 2020. It will include my goals and progress for each week in the program, as well as notes about any observations or surprises.</p>
<p>In my GSOC application, I mentioned keeping a log of my progress in a “progress.md” file. This webpage will hopefully serve as a more easily-accessible version of that idea.</p>
</div>
<div id="community-bonding-period" class="section level1">
<h1 class="hasAnchor">
<a href="#community-bonding-period" class="anchor"></a>Community Bonding Period</h1>
<div id="may-04---may-10" class="section level2">
<h2 class="hasAnchor">
<a href="#may-04---may-10" class="anchor"></a>May 04 - May 10</h2>
<p>Goals:</p>
<ul>
<li>Research existing applications with similar features to what we want with the gfpopgui.</li>
<li>Sketch the layout of the gfpopgui in more detail. This should include an itemized checklist of desired features.</li>
</ul>
<div id="existing-applications" class="section level3">
<h3 class="hasAnchor">
<a href="#existing-applications" class="anchor"></a>Existing Applications</h3>
<div id="shinydag" class="section level4">
<h4 class="hasAnchor">
<a href="#shinydag" class="anchor"></a>shinyDAG</h4>
<p><a href="https://github.com/GerkeLab/shinyDAG">GitHub link</a></p>
<p>A web application that uses R and LaTeX to create publication-quality images of directed acyclic graphs (DAGs).</p>
<p>They allow users to create directed graphs, but I think the interface is a little bit clunky. They preview graphs with Plotly, but I don’t think all of the Plolty features are necessary.</p>
<p>However, I really like how they add nodes: you click “Add New Node” and then you enter properties of the node (in this case, just the name) into a text box. I may want to do something similar with the gfpopgui.</p>
<p>They represent nodes as a list with a name, x cord, and y cord. Seems to identify edges by the IDs of the nodes which they connect, so breaks when nodes have the same name.</p>
<p>Conclusion: Great reference for an interface for creating nodes and interacting between javascript and R.</p>
</div>
<div id="d3-dynamic-report" class="section level4">
<h4 class="hasAnchor">
<a href="#d3-dynamic-report" class="anchor"></a>D3 Dynamic Report</h4>
<p><a href="https://github.com/jienagu/D3_folded_charts">GitHub link</a></p>
<p>Just an example of integrating D3 and Shiny. Besides that, not useful in this context, I don’t think.</p>
</div>
<div id="interactive-tool-for-creating-directed-graphs-using-d3-js" class="section level4">
<h4 class="hasAnchor">
<a href="#interactive-tool-for-creating-directed-graphs-using-d3-js" class="anchor"></a>Interactive tool for creating directed graphs using d3.js</h4>
<p><a href="https://bl.ocks.org/cjrd/6863459">bl.cks link</a></p>
<p>This block is central to and will probably be the basis of the gfpopgui application.</p>
<p>It describes making an editable directed graph with D3 (just javascript, no Shiny).</p>
</div>
<div id="rstudioconf-shiny-app" class="section level4">
<h4 class="hasAnchor">
<a href="#rstudioconf-shiny-app" class="anchor"></a>rstudio::conf shiny app</h4>
<p><a href="https://gadenbuie.shinyapps.io/tweet-conf-dash/">Shinyapp.io link</a></p>
<p>This app isn’t remotely related to gfpopgui, but I really like the layout. It uses the same basic shiny dashboard that people use all the time, but it just feels very nice and clean. It would be great to emulate parts of the design.</p>
</div>
<div id="thinkr-tidytuesday-2019-10-15" class="section level4">
<h4 class="hasAnchor">
<a href="#thinkr-tidytuesday-2019-10-15" class="anchor"></a>thinkr TidyTuesday 2019-10-15</h4>
<p><a href="https://connect.thinkr.fr/tidytuesday201942/">Application link</a></p>
<p>Or maybe this sort of layout would be nicer? It’s definitely simplier, and maybe more intuititive?</p>
</div>
<div id="more" class="section level4">
<h4 class="hasAnchor">
<a href="#more" class="anchor"></a>More?</h4>
<p>I’m really surprised that I’m having this much trouble finding more applications that are similar to what we would like to do. It’s exciting–since it means that we’re doing something somewhat unique–but also a bit scary.</p>
<p>I’ll keep casually looking for more model applications, and make a note to ask about this in my first meeting with Guillem and Toby next week.</p>
</div>
</div>
<div id="layout" class="section level3">
<h3 class="hasAnchor">
<a href="#layout" class="anchor"></a>Layout</h3>
<p>I was off to a slow start this week, so I’m going to move the layout goal to early next week (starting tomorrow!).</p>
</div>
<div id="future-directions" class="section level3">
<h3 class="hasAnchor">
<a href="#future-directions" class="anchor"></a>Future Directions</h3>
<p>I want to make sure that my base knowledge of Shiny is up to par. I’ve never been super satisifed with the available books, but Hadley Wickham is writing one now! It’s not nearly done yet, but I’ll run through what’s already written. <a href="https://mastering-shiny.org/">Link</a>.</p>
</div>
</div>
<div id="may-11---may-17" class="section level2">
<h2 class="hasAnchor">
<a href="#may-11---may-17" class="anchor"></a>May 11 - May 17</h2>
<div id="goals" class="section level3">
<h3 class="hasAnchor">
<a href="#goals" class="anchor"></a>Goals</h3>
<ul>
<li>(Carry-over from last week): app layout sketch, itemized checklist of features we want in the app.</li>
<li>Read the gfpop paper and package documentation in more detail, and make sure to write down questions to ask Guillem and Toby in meeting on Friday.</li>
<li>Think about setting up coding environment: make notes about how you are going to do that, review those with Guillem and Toby on Friday, and then implement them on Friday/Saturday.</li>
</ul>
</div>
<div id="app-layout" class="section level3">
<h3 class="hasAnchor">
<a href="#app-layout" class="anchor"></a>App Layout</h3>
<div id="sketches" class="section level4">
<h4 class="hasAnchor">
<a href="#sketches" class="anchor"></a>Sketches</h4>
<div id="welcome-tab" class="section level5">
<h5 class="hasAnchor">
<a href="#welcome-tab" class="anchor"></a>Welcome Tab</h5>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/may11_may17/layout_1.JPG" alt=""><p class="caption">picture of welcome tab layout sketch</p>
</div>
</div>
<div id="analysis-tab" class="section level5">
<h5 class="hasAnchor">
<a href="#analysis-tab" class="anchor"></a>Analysis Tab</h5>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/may11_may17/layout_2.JPG" alt=""><p class="caption">picture of analysis tab layout sketch</p>
</div>
</div>
<div id="sharing-tab" class="section level5">
<h5 class="hasAnchor">
<a href="#sharing-tab" class="anchor"></a>Sharing Tab</h5>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/may11_may17/layout_3.JPG" alt=""><p class="caption">picture of sharing tab layout sketch</p>
</div>
</div>
<div id="help-tab" class="section level5">
<h5 class="hasAnchor">
<a href="#help-tab" class="anchor"></a>Help Tab</h5>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/may11_may17/layout_4.JPG" alt=""><p class="caption">picture of help tab layout sketch</p>
</div>
</div>
</div>
<div id="components-list" class="section level4">
<h4 class="hasAnchor">
<a href="#components-list" class="anchor"></a>Components List</h4>
<ol style="list-style-type: decimal">
<li>Welcome page
<ul>
<li>Title and subtitle</li>
<li>Overview and instructions</li>
<li>Data upload area
<ol style="list-style-type: decimal">
<li>Upload option: .Rdata file with completed analysis</li>
<li>Upload option: .csv file with input data</li>
<li>Upload option: .csv file with directed graph</li>
</ol>
</li>
</ul>
</li>
<li>Analysis page
<ul>
<li>Main analysis plot (one large D3 plot)
<ol style="list-style-type: decimal">
<li>User data plot
<ul>
<li>Overlain: changepoint predictions</li>
</ul>
</li>
<li>Directed graph constraint</li>
</ol>
</li>
<li>Post-hoc analysis
<ul>
<li>One large D3 plot, just with user data plot
<ul>
<li>Option to draw where the user expects to see changepoints</li>
</ul>
</li>
<li>Quality metrics associated with those expectations (how close to expected are the predicted changepoints?)</li>
</ul>
</li>
</ul>
</li>
<li>Sharing/download page
<ul>
<li>Export all results (.Rdata)</li>
<li>Export input data and graph (.zip of .csv)</li>
<li>Export graph data (.csv)</li>
</ul>
</li>
</ol>
</div>
</div>
<div id="coding-environment-notes" class="section level3">
<h3 class="hasAnchor">
<a href="#coding-environment-notes" class="anchor"></a>Coding environment notes</h3>
<ul>
<li><p>Developing on this GitHub repository, just working off of the <code>master</code> branch.</p></li>
<li><p>Use <a href="https://rstudio.github.io/renv/">renv</a> for dependency management/reproducibility OR, for even more, maybe use <a href="https://thinkr-open.github.io/golem/">golem</a>.</p></li>
<li><p>Extra feature: could use <a href="https://github.com/rstudio/shinymeta">shinymeta</a> to produce PDF/Rmd files based on current Shiny session, which is handy. Like a “download report”.</p></li>
</ul>
</div>
<div id="questionsnotes-about-gfpop" class="section level3">
<h3 class="hasAnchor">
<a href="#questionsnotes-about-gfpop" class="anchor"></a>Questions/Notes about <code>gfpop</code>
</h3>
<ul>
<li><p>Node names need to be unique, right? So, only one node may be named <code>Up</code>, etc.</p></li>
<li><p>In Figure 11: (Side note: typo in legend: you say <code>in absolute vale</code> instead of <code>in absolute value</code>) You set a constraint that the absolute value of each change must be 1, but the absolute value of the means in the blue model around ~8 (pos in chr2) seems to be a lot smaller–closer to 0.5. What am I missing?</p></li>
<li><p>Can you force a certain number of changepoints? (in the copy number example, you say that you set a beta such that they get 13 segments–did you have to do that iteratively?)</p></li>
</ul>
</div>
<div id="lognotes-meta" class="section level3">
<h3 class="hasAnchor">
<a href="#lognotes-meta" class="anchor"></a>Log/notes (meta)</h3>
<p>05/10:</p>
<ul>
<li>Sketched out basic components.</li>
</ul>
<p>05/11:</p>
<ul>
<li><p>Drew out the “home” page, but noticed that just sketching might not be the idea way to plan out the app. Just the components list does that well enough. Would be nice to go ahead and build a skeleton as an example UI. Had some trouble with that at first, so reviewing the mastering-shiny book.</p></li>
<li><p>First, sitting down and giving the gfpop arxiv paper a read-through.</p></li>
</ul>
<p>05/12:</p>
<ul>
<li><p>Maybe the graph/data plots don’t need to be written in D3 entirely from scratch? It looks like plotly may have some event handling, and I may be able to leverage that: <a href="https://stackoverflow.com/a/47407363/8290926">stackoverflow answer</a>.</p></li>
<li><p>Reviewed the gfpop paper yesterday, need to read through that again and ask questions.</p></li>
<li><p>Also finished reading and doing all exercises for “mastering shiny” chapters 2 and 3, plus Chapter 4.1-4.3. Keeping track of progress in a <a href="https://github.com/julianstanley/mastering-shiny-solutions">personal repo</a>.</p></li>
</ul>
<p>05/13:</p>
<ul>
<li><p>Mostly focused on improving Shiny skills. Attended a Shiny workshop hosted by the Harvard Bioinformatics Core 1PM-4PM, but it was a bit too introductory. Finished reading and completing exerciese for “mastering shiny” chapters 4, 5, 6, and 13.</p></li>
<li><p>I’m going to need some more tangible outputs before Friday’s meeting. Tomorrow, I need to wrap up my main goals for the week. I have a couple basic sketches of the UI: I should finish those up and load them. I also need to re-read the gfpop paper one more time and write down questions. I’ve been thinking about the environment, so I should write down a few notes on that and also read more (Chapters 15 and 16) to make sure I have a plan for using best practices for modules and testing.</p></li>
<li><p>Another note: take a closer look at the <a href="tabler.io">Tabler</a> package.</p></li>
</ul>
<p>05/14:</p>
<ul>
<li><p>Off to a good start, finished up initial UI sketches. Also added some coding environment nodes.</p></li>
<li><p>Note: The idea of using plotly instead of base D3 seems to be gaining more traction in my mind. You can customize tooltips with plotly, and add custom event handlers. Carson did a fantastic job documenting the package <a href="https://plotly-r.com/">here</a>. I bet I can do the main interactive changepoint visualization with it. But, the graph-making visualization may still need to be base D3–meaning those graphs would need to be seperated.</p></li>
<li><p>I added some questions about the <code>gfpop</code> paper and package, but I think I still need a bit more time to read the manuscript through a few more times and get a better feel for the aspects of the work that will be practical in designing a good GUI.</p></li>
</ul>
<div id="notes-from-morning-meeting" class="section level4">
<h4 class="hasAnchor">
<a href="#notes-from-morning-meeting" class="anchor"></a>Notes from morning meeting</h4>
<ul>
<li>Calls can be around once per week, but skipping weeks is okay. Maybe next meeting should be around the first week of coding. Meetings can be with just Toby or Guillem, don’t need to be with both.</li>
</ul>
<p>Goals:</p>
<ul>
<li><p>Get comfortable with project integration and package management best practices.</p></li>
<li><p>Can also get in touch with the broader shiny community.</p></li>
<li><p>Generally, focus on keeping comments and records in the open: e.g. make issues on the shiny repo.</p></li>
<li><p>First order of business: put an issue on the visNetwork repo explaining what we would like to do. Are our goals reasonable with visNetwork?</p></li>
<li><p>Carefully read the plotly book, especially the data visualization chapters, especially bits about client-side interactivity (this is how we keep things running quickly!)</p></li>
<li><p>On analysis page: add a dropbox to change the penalty score</p></li>
<li><p>Would also be nice to keep track of previously-run analyses to make them easy to re-run/refer to.</p></li>
<li><p>Would also be nice to have a button to get the R code corresponding to the current graph constraint (this corresponds to a common use case where you have the R code with a current graph, and just want to modify that).</p></li>
<li><p>Analysis and annotation should be the same plot, but should maybe have a button to hide the gfpop results and just add annotation.</p></li>
</ul>
<p>Additional things to look into:</p>
<ul>
<li>Testing! You should be thinking about testing. Look at shinytest and rselenium to get an idea of how that works. It will fireup a headless browser, navigate to the webpage, and automatically test interactive components–e.g. draw on the screen and make sure that a certain number of datapoints appear. Is this compatible with Shiny? You should take a look.</li>
</ul>
</div>
<div id="misc" class="section level4">
<h4 class="hasAnchor">
<a href="#misc" class="anchor"></a>Misc</h4>
<ul>
<li>For the rest of the day and tomorrow, will focus on just doing some general reading. Then, on Sunday (05/17), I’ll get started formulating next week’s goals. That’s a wrap for the week!</li>
</ul>
<p>05/17:</p>
<p>Focused on learning more about Plotly. Started a datacamp course that seems helpful, keeping track of progress <a href="https://github.com/julianstanley/intermediate-interactive-dataviz-plotly">in a GitHub repo</a>. Tomorrow: think more about this week’s goals, and then learn more!</p>
</div>
</div>
</div>
<div id="may-18---may-24" class="section level2">
<h2 class="hasAnchor">
<a href="#may-18---may-24" class="anchor"></a>May 18 - May 24</h2>
<div id="goals-1" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-1" class="anchor"></a>Goals</h3>
<p>This is mostly a learning week. In my original proposal, I thought that the coding period would begin this week. Since I have another two weeks, I’m going to focus on developing a good base.</p>
<ul>
<li>Incorporate Friday’s feedback into GUI layout sketches.</li>
<li>Read more closely into the visNetwork package, potentially post an issue on the GitHub repo.</li>
<li>Learn more about Plotly and Shiny.</li>
</ul>
</div>
<div id="revised-sketches" class="section level3">
<h3 class="hasAnchor">
<a href="#revised-sketches" class="anchor"></a>Revised sketches</h3>
<p>For more information, see <a href="https://github.com/julianstanley/gfpopgui/issues/3">issue #3</a>.</p>
<p>Just needed to revise the analysis tab:</p>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/may18_may24/analysis_revised.JPG" alt=""><p class="caption">revised analysis tab layout</p>
</div>
</div>
<div id="visnetwork-reading" class="section level3">
<h3 class="hasAnchor">
<a href="#visnetwork-reading" class="anchor"></a>visNetwork reading</h3>
<p>For more information, see <a href="https://github.com/julianstanley/gfpopgui/issues/2">issue #2</a>.</p>
<p>I’ve made some progress on visNetwork. I’m now able to record changes to the visNetwork graph, based on <a href="https://stackoverflow.com/questions/54846529/how-to-extract-and-save-visnetwork-manipulation-changes-in-shiny">this stackoverflow post</a>,</p>
</div>
<div id="plotly-and-shiny-reading" class="section level3">
<h3 class="hasAnchor">
<a href="#plotly-and-shiny-reading" class="anchor"></a>Plotly and Shiny Reading</h3>
<p>Mostly focused on Plotly, namely following an intermediate course on datacamp. The course helped me a lot in getting more comfortable with plotly syntax and client-side interactivity. My notes <a href="https://github.com/julianstanley/intermediate-interactive-dataviz-plotly">are here</a>.</p>
</div>
<div id="lognotes-meta-1" class="section level3">
<h3 class="hasAnchor">
<a href="#lognotes-meta-1" class="anchor"></a>Log/notes (meta)</h3>
<p>No need for day-by-day updates this week. Lots of reading and notetaking, but nothing especially noteworthy.</p>
<p>I’m also moving some of this commentary to the “issues” tab of the main repository, even though I will keep documenting progress here. This progress log may evolve into more of a blog, unsure.</p>
<p>Note to self: on May 24th, post on the RStudio community forum asking for help picking a tool to make the constraint graph visualization. The folks over there seem exceptionally helpful.</p>
</div>
</div>
<div id="may-25---may-31" class="section level2">
<h2 class="hasAnchor">
<a href="#may-25---may-31" class="anchor"></a>May 25 - May 31</h2>
<p>This is the last week in the community bonding period! From now on, these timeline posts will be more like a reflective blog than a day-by-day update. Those updates <a href="https://github.com/julianstanley/gfpopgui/issues">have now moved to the issues tab of the repo</a>.</p>
<p>So, I’ll write these posts at the end of the week and highlight some of the things that I learned.</p>
<div id="goals-2" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-2" class="anchor"></a>Goals</h3>
<ul>
<li>Hone in on whether plotly or visNetwork are best for making the constraint graph visualization.</li>
<li>Make a shell application</li>
<li>Start on testing</li>
</ul>
</div>
<div id="quick-reflection" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-reflection" class="anchor"></a>Quick Reflection</h3>
<p>Although this is a community bonding period week, I felt that I needed to get started coding to get a feel for what additional things I needed to learn from the community.</p>
<p>As a result, I think this week was very productive: I built a semi-functional shiny application and feel that I have a very clear direction for this project.</p>
</div>
<div id="golem-and-shiny-project-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#golem-and-shiny-project-structure" class="anchor"></a><code>golem</code> and Shiny project structure</h3>
<p><code>golem</code> is a fantastic package, and <a href="https://thinkr-open.github.io/golem/articles/a_start.html">the documentation</a> by itself was basically all I needed to get started.</p>
<p>It’s been useful to me mostly as just a guideline for <code>shiny</code> best practices. For example, it encouraged me to use <code>usethat</code> functions to setup things like <code>covr</code>, which was much faster and less problematic than setting it up on my own.</p>
<p>It also convinced me to use a proper package structure for my shiny app. So far, that has been great to keep track of dependencies and use build tools.</p>
<p>There were a few things that I struggled with this week that I should share:</p>
<div id="organizing-tabs" class="section level4">
<h4 class="hasAnchor">
<a href="#organizing-tabs" class="anchor"></a>Organizing tabs</h4>
<p>When working on an application with multiple tabs, I don’t think the typical module structure is the best way to organize the tabs.</p>
<p>Instead, just put the ui and server components of each tab in a separate file and folder–for example, the ui for the home tab goes in <code>R/ui/tab_home.R</code>. Then, in your main <code>app_ui.R</code> file, just call:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"R"</span>, <span class="st">"ui"</span>, <span class="st">"tab_home.R"</span>), <span class="kw">local</span> <span class="kw">=</span> <span class="fl">TRUE</span>)$<span class="no">value</span></pre></body></html></div>
<p>to source the file. Nothing fancy, just keeping different tabs in different files.</p>
</div>
</div>
<div id="sourcing-seperate-html-files" class="section level3">
<h3 class="hasAnchor">
<a href="#sourcing-seperate-html-files" class="anchor"></a>Sourcing seperate HTML files</h3>
<p>My home tab has a big block of HTML that I wanted to move to a separate file.</p>
<p><code>golem</code> creates a shortcut from <code>/inst/app/www</code> to just <code>www</code>, so I sourced my HTML file like:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu">includeHTML</span>(<span class="st">"www/lorem.html"</span>)</pre></body></html></div>
<p>That worked! But, one of the <code>golem</code> recommended tests failed.</p>
<p>That’s because sourcing the file like that was visible from the web browser, but not to the R interpreter.</p>
<p>Instead, I needed to use <code>system.file</code> to source the file:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu">includeHTML</span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"app/www/lorem.html"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"gfpopgui"</span>))</pre></body></html></div>
</div>
<div id="travis-ci-and-automated-shinyapp-io-builds" class="section level3">
<h3 class="hasAnchor">
<a href="#travis-ci-and-automated-shinyapp-io-builds" class="anchor"></a>Travis CI, and automated shinyapp.io builds</h3>
<p>This week, I setup my package to build/test through TravisCI, check through <code>covr</code>, and auto-deploy to shinyapps.io.</p>
<div id="cachepackages-and-r_github_packages" class="section level4">
<h4 class="hasAnchor">
<a href="#cachepackages-and-r_github_packages" class="anchor"></a>cache:packages and r_github_packages:</h4>
<p>This is worth its own header. In my last R project, I didn’t have the <code>cache:packages</code> option set. However, caching packages speeds up the build <em>so, so much</em>.</p>
<p>e.g.:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> R</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">cache</span><span class="kw">:</span><span class="at"> packages</span></span></code></pre></div>
<p>I also learned about the <code>r_github_packages</code> option, which lets you install an R package from GitHub on the Travis node, e.g.:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">r_github_packages</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="at">  </span><span class="kw">-</span><span class="at"> julianstanley/gfpopgui</span></span></code></pre></div>
<p>However, my auto-deploy to shinyapps.io had some weird problems.</p>
</div>
</div>
<div id="visnetwork-works" class="section level3">
<h3 class="hasAnchor">
<a href="#visnetwork-works" class="anchor"></a>visNetwork works!</h3>
<p>For the past few weeks, I’ve been trying to figure out how to make a proper, interactive, editable plot for the constraint graph.</p>
<p>This week, thanks to some updates on the visNetwork package, I have that!</p>
<p>It’s still not perfect, and there’s a small bug in the ability to edit edges, but it’s good enough for now.</p>
<p>The new features is the ability to add custom edit attributes to graphs–and to be able to edit edge attributes at all.</p>
<p>So, for example, let’s say I wanted users to be able to edit a nodeParam in nodes and an edgeParam in edges, I could add the <code>editNodeCols</code> and <code>editEdgeCols</code> parameters in <code>visOptions</code> like this:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">visNetwork</span>(<span class="kw">nodes</span> <span class="kw">=</span> <span class="no">nodes</span>, <span class="kw">edges</span> <span class="kw">=</span> <span class="no">edges</span>) <span class="kw">%&gt;%</span>
  <span class="fu">visOptions</span>(<span class="kw">manipulation</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">enabled</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">editEdgeCols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"label"</span>, <span class="st">"to"</span>, <span class="st">"from"</span>, <span class="st">"edgeParam"</span>),
    <span class="kw">editNodeCols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"label"</span>, <span class="st">"nodeParam"</span>)
  ))</pre></body></html></div>
<p>But, even though this feature allows users to edit nodes, it doesn’t provide any straightforward functionality to update the node and edge data after the user edits it in a shiny app. That’s where the <code>input$[graph_name]_graphChange</code> element comes in!</p>
<p>If my graph is named <code>input$mygraph</code>, then user edit events to that graph will show up in <code>input$mygraph_graphChange</code>! <code>input$mygraph_graphChange</code> will be a list, where the <code>cmd</code> parameter of that list specifies the user event, and other parameters specify changes to the node/edge.</p>
<p>So, to respond to a user event editing an edge, I can use <code>observeEvent</code> from shiny as follows:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">observeEvent</span>(<span class="no">input</span>$<span class="no">mygraph_graphChange</span>, {
  <span class="no">event</span> <span class="kw">&lt;-</span> <span class="no">input</span>$<span class="no">mygraph_graphChange</span>
  <span class="no">cmd</span> <span class="kw">&lt;-</span> <span class="no">event</span>$<span class="no">cmd</span>

  <span class="kw">if</span> (<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"editEdge"</span>) {
    <span class="no">mygraph_edges</span> <span class="kw">&lt;-</span> <span class="no">mygraph_edges</span> <span class="kw">%&gt;%</span>
      <span class="fu">mutate_cond</span>(<span class="no">id</span> <span class="kw">==</span> <span class="no">event</span>$<span class="no">id</span>,
        <span class="kw">to</span> <span class="kw">=</span> <span class="no">event</span>$<span class="no">to</span>, <span class="kw">from</span> <span class="kw">=</span> <span class="no">event</span>$<span class="no">from</span>,
        <span class="kw">label</span> <span class="kw">=</span> <span class="no">event</span>$<span class="no">label</span>) <span class="co"># etc with other parameters</span>
  }
})</pre></body></html></div>
<p>Where <code>mutate_cond</code> is a nice fancy custom modification on <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> that edits rows based on a parameter, instead of columns. You can define it like this:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">mutate_cond</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">.data</span>, <span class="no">condition</span>, <span class="no">...</span>, <span class="no">envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span>()) {
  <span class="no">condition</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span>(<span class="no">condition</span>), <span class="no">.data</span>, <span class="no">envir</span>)
  <span class="no">.data</span>[<span class="no">condition</span>, ] <span class="kw">&lt;-</span> <span class="no">.data</span>[<span class="no">condition</span>, ] <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(<span class="no">...</span>)
  <span class="no">.data</span>
}</pre></body></html></div>
<p>So, thanks to these features, our editable graph is now feasible! I’ll need to read up a bit more on visNetworkProxy to make the graph updates more efficient, and work on making the graph prettier and more user-friendly (and implement it in the first place)!</p>
<p>While I haven’t put the graph into production yet, I wrote a quick <a href="https://gist.github.com/julianstanley/74321b6b75584e9e17cd68666b2177c2">proof-of-concept gist</a>, if you want to take a look!</p>
</div>
<div id="issues-branches-and-pull-requests" class="section level3">
<h3 class="hasAnchor">
<a href="#issues-branches-and-pull-requests" class="anchor"></a>Issues, branches, and pull requests</h3>
<div id="issues" class="section level4">
<h4 class="hasAnchor">
<a href="#issues" class="anchor"></a>Issues</h4>
<p>Finally, this week has really increased my appreciation for using issues, branches, and pull requests. In fact, I think I’ve been using them a lot more than most users (hopefully not too much!)</p>
<p>Just this week, I opened 12 issues in gfpopgui, as well as <a href="https://github.com/vrunge/gfpop/issues/11">one in gfpop</a>, <a href="https://github.com/rstudio/shinytest/issues/312">one in shinytest</a>, and one in <a href="https://github.com/datastorm-open/visNetwork/issues/377">visNetwork</a>, and also <a href="https://github.com/ThinkR-open/golem/issues/263">commented on some in golem</a>.</p>
<p>I think that creating issues for my own repository has been a fantastic way to keep track of my progress and thoughts, which has helped me be more focused and productive. And creating issues in other repositories, as well as participating in conversations in the <a href="https://community.rstudio.com">RStudio community forums</a> has really helped me to connect with the open-source community, and think more critically about how to ask good questions and contribute thoughtfully.</p>
<p>Finally, just seeing public comments on issues tabs and forums has had a big impact on the way that I code and think. There are so many good suggestions and helpful tidbits out there in the public!</p>
</div>
<div id="branches-and-pull-requests" class="section level4">
<h4 class="hasAnchor">
<a href="#branches-and-pull-requests" class="anchor"></a>Branches and Pull Requests</h4>
<p>I think I had previously underestimated the utility of creating branches and pull requesting on repositories where I am the primary contributor.</p>
<p>While branches <em>are</em> most helpful for projects with a group of simultaneous contributors, I have found them really helpful for myself this week.</p>
<p>In previous projects, I often found myself panicking when I made build-breaking changes to the master branch. Then, in that panic, I would revert some commits or have a long string of commits as I tried to fix the repo.</p>
<p>With branches that build independently, I can work through problems like that in an isolated environment, and then delete changes and/or rebase before merging that branch into master, being confident that I’m pushing polished changes.</p>
</div>
</div>
<div id="testing" class="section level3">
<h3 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h3>
<p>I’m still working on testing. But, in short, <code>shinytest</code> seems awesome for most testing purposes. However, it fails when you need your tests to include client-side interactions, like panning/zooming in a plotly plot. For those interactions, RSelenium seems like the best option. I’m going to work more on getting RSelenium set up, and hopefully will write more about that in the timeline blog next week!</p>
</div>
</div>
</div>
<div id="phase-1" class="section level1">
<h1 class="hasAnchor">
<a href="#phase-1" class="anchor"></a>Phase 1</h1>
<div id="june-01---june-07" class="section level2">
<h2 class="hasAnchor">
<a href="#june-01---june-07" class="anchor"></a>June 01 - June 07</h2>
<div id="goals-3" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-3" class="anchor"></a>Goals</h3>
<ul>
<li>Set up an RSelenium testing framework</li>
<li>Further modularize code</li>
</ul>
</div>
<div id="quick-reflection-1" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-reflection-1" class="anchor"></a>Quick Reflection</h3>
<p>This week was mostly about debugging testing. Although I did not have as much visible output of my work this week, I still think it was productive overall. I think that moving forward with this project will be much easier now that I’ve established a strong base of support.</p>
</div>
<div id="in-shiny-development-modules-are-important-and-useful" class="section level3">
<h3 class="hasAnchor">
<a href="#in-shiny-development-modules-are-important-and-useful" class="anchor"></a>In Shiny development, modules are important and useful</h3>
<p>Last week, I talked about using <code>source(file.path("R", "ui", "tab_home.R"), local = TRUE)$value</code>, etc. to seperate the different tabs of my application.</p>
<p>This week, that decision came back to bite me. The problem is that, in many shiny applications, all components of the application are stored in <code>inst/</code>, so all of those files are preserved when the package is built and distributed.</p>
<p>However, when building an app with <code>golem</code> (like I am), shiny logic is kept in the <code>R/</code> directory, which is modified when a package is built and distributed.</p>
<p>So, all that to say that the <code>source</code> approach was making my application break at weird times.</p>
<p>I should have built the different parts of my application as shiny modules in the first place. The <a href="https://mastering-shiny.org/scaling-modules.html">modules section in the mastering-shiny book</a> was very useful in learning more about how to make modules, and the reading was well worth the effort.</p>
</div>
<div id="rselenium-is-finicky-but-potentially-worth-it" class="section level3">
<h3 class="hasAnchor">
<a href="#rselenium-is-finicky-but-potentially-worth-it" class="anchor"></a>RSelenium is finicky, but potentially worth-it</h3>
<p>Here’s a guide to setting up RSelenium with Shiny:</p>
<ol style="list-style-type: decimal">
<li>Install the RSelenium R package: `install.packages(“RSelenium”)</li>
<li>Install Docker (on Ubuntu: <code>sudo apt install docker</code>)</li>
<li>Run a docker Selenium instance, making sure to set <code>--net=host</code>: docker run -d –net=host selenium/standalone-firefox&amp;</li>
<li>Open a Selenium instance from R:</li>
</ol>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">remDr</span> <span class="kw">&lt;-</span> <span class="fu">remoteDriver</span>(<span class="kw">remoteServerAddr</span> <span class="kw">=</span> <span class="st">"localhost"</span>, <span class="kw">port</span> <span class="kw">=</span> <span class="fl">4444</span>, <span class="kw">browser</span> <span class="kw">=</span> <span class="st">"firefox"</span>)
<span class="no">remDr</span>$<span class="fu"><a href="https://rdrr.io/r/base/connections.html">open</a></span>(<span class="kw">silent</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>At this point, if you navigate to <code>http://localhost:4444/wd/hub/static/resource/hub.html</code> in a browser, you should see a helpful Selenium interface.</p>
<ol start="5" style="list-style-type: decimal">
<li>Run an instance of your shiny app in the background on a known port:</li>
</ol>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span>(<span class="st">"${R_HOME}/bin/Rscript -e 'library(gfpopgui);options(shiny.port = 15123);run_app()' &amp;"</span>,
       <span class="kw">ignore.stdout</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
       <span class="kw">ignore.stderr</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<ol start="6" style="list-style-type: decimal">
<li>Use the <code>remDr</code> object to open the shiny app in a headless Selenium browser: <code>remDr$navigate(url = "http://127.0.0.1:15123")</code>.</li>
<li>Use the <code>remDr</code> object to interact with the app, or get information from it (e.g.: <code>appTitle &lt;- remDr$getTitle()[[1]]</code>). You can now use this information in tests.</li>
</ol>
<p>I personally put sets 4-7 within a testthat script. So, that script just requires that a Selenium instance is running. That means that my tests can run locally and also on Travis by including:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="at">  </span><span class="kw">-</span><span class="at"> docker</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">before_install</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="at">  </span><span class="kw">-</span><span class="at"> docker pull selenium/standalone-firefox</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="at">  </span><span class="kw">-</span><span class="at"> docker run -d --net=host -p 127.0.0.1:4444:4444 selenium/standalone-firefox</span></span></code></pre></div>
<p>in my <code>.travis.yml</code>.</p>
<p>The only caveat is that running the shiny app in the background often takes a few seconds, so I include a <code><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep(10)</a></code> statement before running <code>remDr$navigate</code> to give the app time to reload.</p>
<p>We’ll see in the coming weeks if the effort to get this debugged was worth it!</p>
</div>
<div id="use-dtrenderdatatable-not-shinyrenderdatatable" class="section level3">
<h3 class="hasAnchor">
<a href="#use-dtrenderdatatable-not-shinyrenderdatatable" class="anchor"></a>Use DT::renderDataTable, not shiny::renderDataTable</h3>
<p>While modularizing my code this week, I noticed that I had some errors through Travis that I could not reproduce locally. If you’re reading this and are interested, <a href="https://community.rstudio.com/t/x-must-be-a-vector-travis-but-not-local/68717">here’s a link to my community.rstudio post about the problem</a>.</p>
<p>Ultimately, I was able to fix the problem by upgrading my R version, which was a few months out of date.</p>
<p>When I updated, I got errors in my <code><a href="https://shiny.rstudio.com/reference/shiny/latest/renderDataTable.html">shiny::renderDataTable</a></code> calls. Evidently <a href="https://community.rstudio.com/t/shiny-1-3-2-renderdatatable-cant-work-now/41935/2">others were also having the same problems in newer R versions</a> and the developers are moving from <code><a href="https://shiny.rstudio.com/reference/shiny/latest/renderDataTable.html">shiny::renderDataTable</a></code> to <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">DT::renderDataTable</a></code>, and switching those functions (and having to tweak a bit to get them to work) fixed things up.</p>
<p>But, this episode convinced me that I needed to be more explicit about where my functions come from. So, I’ve completely removed <code>@import</code> statements in my ROxygen documentation comments and replaced them with <code>@importFrom</code> statements. This way, I am being explicit about the packages from which each of my function calls come.</p>
</div>
</div>
<div id="june-08---june-14" class="section level2">
<h2 class="hasAnchor">
<a href="#june-08---june-14" class="anchor"></a>June 08 - June 14</h2>
<div id="goals-4" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-4" class="anchor"></a>Goals</h3>
<p>This week is a feature development-heavy week. I would like to:</p>
<ul>
<li>Create a working, interactive graph</li>
<li>Improve the plotly visualization (namely: tooltip should only work on the segments/changepoints and give useful info)</li>
</ul>
</div>
<div id="quick-reflection-2" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-reflection-2" class="anchor"></a>Quick Reflection</h3>
<p>I’m writing this on June 15th (I’m late this week!), but last week went very well.</p>
<p>June 01-07 was difficult for me because it was mostly getting testing initially setup and debugged, which was frustrating because it felt like I wasn’t making significant progress.</p>
<p>This week, in contrast, felt like I was making a lot of progress because I was directly working on new app features. This short timeline post will cover a couple things that I learned while making two of those features.</p>
</div>
<div id="overlaying-segment-markers-on-a-plotly-visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#overlaying-segment-markers-on-a-plotly-visualization" class="anchor"></a>Overlaying segment markers on a plotly visualization</h3>
<p>The <a href="https://arxiv.org/abs/2002.03646">2020 gfpop paper</a> provided me two different examples of what a changepoint plot should look like:</p>
<p><img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/june08_june14/changepoints_1.png" alt="changeplot plot 1"><img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/june08_june14/changepoints_2.png" alt="changeplot plot 2"></p>
<p>So, it was clear that I needed to have a base plot of the main data, and overlain bars to indicate the changepoints.</p>
<p>The main data was easy enough. The user provides that data in <code>gfpop_data$main_data</code>, so I can just plot the X and Y columns of that data.</p>
<p>Importantly, I want to disable tooltips with <code>hoverinfo = 'none'</code> so that they don’t interfere when the user tries to hover over a changepoint bar:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">base_plot</span> <span class="kw">&lt;-</span> <span class="fu">plot_ly</span>(<span class="no">gfpop_data</span>$<span class="no">main_data</span>, <span class="kw">x</span> <span class="kw">=</span> ~<span class="no">X</span>, <span class="kw">y</span> <span class="kw">=</span> ~<span class="no">Y</span>, <span class="kw">hoverinfo</span> <span class="kw">=</span> <span class="st">'none'</span>)</pre></body></html></div>
<p>Then comes the harder part. I have changepoint data (from running <code><a href="https://rdrr.io/pkg/gfpop/man/gfpop.html">gfpop::gfpop()</a></code> on <code>gfpop_data$main_data</code> and the user-provided graph), and I need to overlay that data on the plot.</p>
<p>Originally, I overlayed that data using the <code>geom_segment</code> layer, or the plotly equivalent <code>add_segments()</code>. That works well, but has a big downside: segments cannot have their own tooltips. I should post an issue on the plotly GitHub page to make sure that’s the case.</p>
<p>So, instead, I need to create many points along where the changepoint regions are supposed to go, and then connect them with a line, since a line can have a tooltip. I also will need a separate trace for segments (e.g. spans along the X axis without changepoints) and for the changepoints themselves, since they need to be two different colors.</p>
<p>I ended up writing a function that I am not super proud of called <code>add_changepoints</code>. It loops through each of the changepoints returned by <code><a href="https://rdrr.io/pkg/gfpop/man/gfpop.html">gfpop::gfpop</a></code> and creates a dataframe that includes many points and a description for each changepoint, adds that to an accumulator dataframe, and then uses that accumulator dataframe to draw lines. This just seems unnecessarily resource intensive and verbose for what I want to do, but here’s the code:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">add_changepoints</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">plotly_obj</span>, <span class="no">original_data</span>, <span class="no">changepoint_data</span>) {
  <span class="co"># Initialize plotly object to return</span>
  <span class="no">return_plotly</span> <span class="kw">&lt;-</span> <span class="no">plotly_obj</span> <span class="kw">%&gt;%</span>
    <span class="fu">hide_legend</span>()

  <span class="no">changepoint_annotations_regions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(), <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>())
  <span class="no">changepoint_annotations</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(), <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>())

  <span class="no">changepoints</span> <span class="kw">&lt;-</span> <span class="no">changepoint_data</span>$<span class="no">changepoints</span>

  <span class="co"># Note: ds = dataspace, since changepoint data refers to indicates, not in dataspace</span>
  <span class="no">previous_changepoint</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="no">previous_changepoint_ds</span> <span class="kw">&lt;-</span> <span class="no">original_data</span>$<span class="no">X</span>[<span class="fl">1</span>]
  <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
  <span class="co"># Add each changepoint to the given plotly object</span>
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">changepoints</span>)) {
    <span class="no">changepoint</span> <span class="kw">&lt;-</span> <span class="no">changepoints</span>[<span class="no">i</span>]
    <span class="no">changepoint_ds</span> <span class="kw">&lt;-</span> <span class="no">original_data</span>$<span class="no">X</span>[<span class="no">changepoint</span>]

    <span class="co"># The region preceeding a changepoint, or between two changepoints</span>
    <span class="no">changeregion</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="no">previous_changepoint</span>, <span class="no">changepoint</span>)
    <span class="no">changeregion_ds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="no">previous_changepoint_ds</span>,
      <span class="no">changepoint_ds</span>,
      <span class="kw">length.out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">changeregion</span>)
    )

    <span class="no">changepoint_annotations_regions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(
      <span class="no">changepoint_annotations_regions</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">changeregion_ds</span>, <span class="fl">NA</span>),
                 <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">changepoint_data</span>$<span class="no">parameters</span>[<span class="no">i</span>], <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">changeregion_ds</span>)), <span class="fl">NA</span>),
                 <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(
                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(
                   <span class="st">"State: "</span>, <span class="no">changepoint_data</span>$<span class="no">states</span>[<span class="no">i</span>], <span class="st">"\n"</span>,
                   <span class="st">"Region mean: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">changepoint_data</span>$<span class="no">parameters</span>[<span class="no">i</span>], <span class="fl">2</span>), <span class="st">"\n"</span>,
                   <span class="st">"Next changepoint: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">changepoint_ds</span>, <span class="fl">2</span>)
                 ),
                 <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">changeregion_ds</span>)), <span class="fl">NA</span>)
      )
    )
    <span class="co"># If this isn't the first region, connect this region with the last</span>
    <span class="kw">if</span> (<span class="no">i</span> <span class="kw">&gt;</span> <span class="fl">1</span>) {
      <span class="no">changepoint_annotations</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(
        <span class="no">changepoint_annotations</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
          <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">previous_changepoint_ds</span>, <span class="fl">50</span>), <span class="fl">NA</span>),
          <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="no">changepoint_data</span>$<span class="no">parameters</span>[<span class="no">i</span> - <span class="fl">1</span>],
                                  <span class="no">changepoint_data</span>$<span class="no">parameters</span>[<span class="no">i</span>],
                                  <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">50</span>
          ), <span class="fl">NA</span>),
          <span class="kw">text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Changepoint #"</span>, <span class="no">i</span>-<span class="fl">1</span>, <span class="st">": "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">previous_changepoint_ds</span>, <span class="fl">2</span>)), <span class="fl">50</span>),
                   <span class="fl">NA</span>)
        )
      )
    }

    <span class="co"># Update the previous changepoints</span>
    <span class="no">previous_changepoint</span> <span class="kw">&lt;-</span> <span class="no">changepoint</span>
    <span class="no">previous_changepoint_ds</span> <span class="kw">&lt;-</span> <span class="no">changepoint_ds</span>
  }

  <span class="no">return_plotly</span> <span class="kw">%&gt;%</span>
    <span class="fu">add_lines</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">changepoint_annotations_regions</span>,
              <span class="kw">x</span> <span class="kw">=</span> ~<span class="no">x</span>,
              <span class="kw">y</span> <span class="kw">=</span> ~<span class="no">y</span>,
              <span class="kw">color</span> <span class="kw">=</span> ~<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="st">"#40B0A6"</span>),
              <span class="kw">hoverinfo</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">text</span> <span class="kw">=</span> ~<span class="no">text</span>,
              <span class="kw">connectgaps</span> <span class="kw">=</span> <span class="no">F</span>,
              <span class="kw">line</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">width</span> <span class="kw">=</span> <span class="fl">7</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">add_lines</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">changepoint_annotations</span>,
              <span class="kw">x</span> <span class="kw">=</span> ~<span class="no">x</span>,
              <span class="kw">y</span> <span class="kw">=</span> ~<span class="no">y</span>,
              <span class="kw">color</span> <span class="kw">=</span> ~<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="st">"#E1BE6A"</span>),
              <span class="kw">hoverinfo</span> <span class="kw">=</span> <span class="st">"text"</span>, <span class="kw">text</span> <span class="kw">=</span> ~<span class="no">text</span>,
              <span class="kw">connectgaps</span> <span class="kw">=</span> <span class="no">F</span>,
              <span class="kw">line</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">width</span> <span class="kw">=</span> <span class="fl">7</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="kw">hovermode</span> <span class="kw">=</span> <span class="st">"x unified"</span>)
}</pre></body></html></div>
<p>And, in the app, it generates plots like this:</p>
<div class="figure">
<img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/june08_june14/changepoints_3.png" alt=""><p class="caption">changeplot plot 3</p>
</div>
<p>For the time being, this accomplishes what I need it to do–but I should come back to this later in the project.</p>
<p>In the meantime, I <a href="https://community.rstudio.com/t/tooltip-for-geom-segment-add-segments-in-plotly/69910">posted this on RStudio community</a>.</p>
</div>
<div id="monitoring-user-changes-in-visnetwork" class="section level3">
<h3 class="hasAnchor">
<a href="#monitoring-user-changes-in-visnetwork" class="anchor"></a>Monitoring user changes in visNetwork</h3>
<p>When a user edits a visNetwork plot, the data underlying the plot remains unchanged.</p>
<p>So, in the case of gfpopgui, where I want to take user’s visNetwork graph edits and use the resulting graph to estimate changepoints, I need additional code to watch for graph edits and edit the underlying graph data.</p>
<p>visNetwork provides that functionality by passing user edits in an object contained in <code>input${graph name}_graphChange</code>. So, in the case of gfpopgui, the graph name is <code>gfpopGraph</code>, so the input to observe is <code>input$gfpopGraph_graphChange</code>.</p>
<p>The <code>input$gfpopGraph_graphChange</code> object has a <code>cmd</code> entry that specifies the type of change. Then, in response to those different graphChange commands, I can edit the data:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">event</span> <span class="kw">&lt;-</span> <span class="no">input</span>$<span class="no">gfpopGraph_graphChange</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"editEdge"</span>) {
    <span class="co"># What happens when the user edits an edge?</span>
    <span class="co"># In this case, I used `mutate_cond`</span>
}

<span class="co">### Add Edge ---------------------------------------------------------------</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"addEdge"</span>) {
    <span class="co"># Add edge response</span>
}

<span class="co">### Delete Edge ------------------------------------------------------------</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"deleteElements"</span> <span class="kw">&amp;&amp;</span> (<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">event</span>$<span class="no">edges</span>) <span class="kw">&gt;</span> <span class="fl">0</span>)) {
    <span class="co"># When the user deletes elements, the resulting event has $edges and $nodes </span>
    <span class="co"># that are changed</span>
}

<span class="co">### Add Node ---------------------------------------------------------------</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"addNode"</span>) {
    <span class="co"># Add node response</span>
}

<span class="co">### Edit Node --------------------------------------------------------------</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"editNode"</span>) {
    <span class="co"># Edit node response</span>
}

<span class="co">### Delete Node ------------------------------------------------------------</span>
<span class="kw">if</span> (<span class="no">event</span>$<span class="no">cmd</span> <span class="kw">==</span> <span class="st">"deleteElements"</span> <span class="kw">&amp;&amp;</span> (<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">event</span>$<span class="no">nodes</span>) <span class="kw">&gt;</span> <span class="fl">0</span>)) {
    <span class="co"># Delete node response</span>
}</pre></body></html></div>
</div>
</div>
<div id="june-15---june-21" class="section level2">
<h2 class="hasAnchor">
<a href="#june-15---june-21" class="anchor"></a>June 15 - June 21</h2>
<div id="goals-5" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-5" class="anchor"></a>Goals</h3>
<p>While last week was a feature-heavy week, this one is more about stepping back, cleaning up, and testing.</p>
<p>My goals are to:</p>
<ul>
<li>Abstract and clean up code</li>
<li>Implement some more testing</li>
</ul>
</div>
<div id="quick-reflection-3" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-reflection-3" class="anchor"></a>Quick Reflection</h3>
<p>This week felt slower than last, but I learned a lot. First, the new <code>testServer</code> functionality in Shiny is really helpful–I’ll talk about that more below. Second, I have read more carefully about the <code>gfpop</code> package itself, and can work next week to put what I learned into the application.</p>
</div>
<div id="testserver" class="section level3">
<h3 class="hasAnchor">
<a href="#testserver" class="anchor"></a>testServer</h3>
<p>The new <code>testServer</code> functionality relies on a particular module structure that is implemented in the current Shiny version, 1.4, and will be recommended after 1.5 is released.</p>
<div id="background-new-module-structure" class="section level4">
<h4 class="hasAnchor">
<a href="#background-new-module-structure" class="anchor"></a>Background: new module structure</h4>
<p>In the old module structure, server modules were written as follows:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># In the module.R file</span>
<span class="no">example_module_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
    <span class="co"># Server code here</span>
}</pre></body></html></div>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># In the server.R file</span>
<span class="no">app_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
    <span class="fu">callModule</span>(<span class="no">example_module_server</span>, <span class="st">"unique-id"</span>)
}</pre></body></html></div>
<p>In the new module structure, server modules are written a bit differently:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># In the module.R file</span>
<span class="no">example_module_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">id</span>) {
    <span class="fu">moduleServer</span>(
        <span class="no">id</span>,
        <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
    <span class="co"># Server code here</span>
    })
}</pre></body></html></div>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co"># In the server.R file</span>
<span class="no">app_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
    <span class="fu">example_module_server</span>(<span class="st">"unique-id"</span>)
}</pre></body></html></div>
<p>This new format is helpful because the <code>callModule</code> part of the old format is built-in to the module function–so, essentially, you have a <strong>single, self-contained</strong> server function, rather than a function that can only be called through <code>callModule</code>.</p>
<p><code>golem</code> still recommends/uses the old module format, so I submitted an <a href="https://github.com/ThinkR-open/golem/issues/455">issue on their repo</a> to remind them to update their recommendations once Shiny 1.5 is released.</p>
</div>
<div id="testing-overview" class="section level4">
<h4 class="hasAnchor">
<a href="#testing-overview" class="anchor"></a>Testing Overview</h4>
<p>The new <code>testModule</code> functionality relies on the new module structure, since it expects a single function to contain the whole server module.</p>
<p>It’s really great because it allows you to access all of the inputs inside of your reactive shiny objects. For example,</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shiny</span>)
<span class="no">example_module_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">id</span>) {
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html">moduleServer</a></span>(
    <span class="no">id</span>,
    <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
      <span class="no">myvals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveValues.html">reactiveValues</a></span>(<span class="kw">example</span> <span class="kw">=</span> <span class="st">"Hello, world!"</span>)
    }
  )
}

<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/testServer.html">testServer</a></span>(<span class="no">example_module_server</span>, {
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">myvals</span>$<span class="no">example</span>)
})</pre></body></html></div>
<div class="sourceCode" id="cb20"><html><body><pre class="r">[1] "Hello, world!"</pre></body></html></div>
<p>It also allows you to set inputs:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shiny</span>)
<span class="no">example_module_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">id</span>) {
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html">moduleServer</a></span>(
    <span class="no">id</span>,
    <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
      <span class="no">my_func</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactive.html">reactive</a></span>({
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">input</span>$<span class="no">my_input</span>)
      })
    }
  )
}

<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/testServer.html">testServer</a></span>(<span class="no">example_module_server</span>, {
  <span class="no">session</span>$<span class="fu">setInputs</span>(<span class="kw">my_input</span> <span class="kw">=</span> <span class="st">"This is my input!"</span>)
  <span class="fu">my_func</span>()
})</pre></body></html></div>
</div>
<div id="problems-testing" class="section level4">
<h4 class="hasAnchor">
<a href="#problems-testing" class="anchor"></a>Problems Testing</h4>
<p>One problem I’ve had is that I can’t use <code>testServer</code> to trigger click events directly:</p>
<p>This testServer code should print “Button was pressed”, but it doesn’t.]</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shiny</span>)
<span class="no">example_module_server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">id</span>) {
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html">moduleServer</a></span>(
    <span class="no">id</span>,
    <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>, <span class="no">session</span>) {
      <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">eventReactive</a></span>(<span class="no">input</span>$<span class="no">my_button</span>, {
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Button was pressed"</span>)
      })
    }
  )
}

<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/testServer.html">testServer</a></span>(<span class="no">example_module_server</span>, {
  <span class="co"># my_button should already be NULL, but for good measure:</span>
  <span class="no">session</span>$<span class="fu">setInputs</span>(<span class="kw">my_button</span> <span class="kw">=</span> <span class="kw">NULL</span>)
  <span class="co"># This should be what happens when the button is pressed</span>
  <span class="no">session</span>$<span class="fu">setInputs</span>(<span class="kw">my_button</span> <span class="kw">=</span> <span class="fl">0</span>)
})</pre></body></html></div>
<p>Has no output. So, I commented on an <a href="https://github.com/rstudio/shiny/issues/2745">existing shiny issue</a> to hopefully have that fixed.</p>
</div>
</div>
<div id="further-features" class="section level3">
<h3 class="hasAnchor">
<a href="#further-features" class="anchor"></a>Further features</h3>
<p>That’s it for this week, but more information about this week’s progress is located in <a href="https://github.com/julianstanley/gfpopgui/issues">the issues tab of the gfpopgui repo</a>.</p>
</div>
</div>
<div id="june-22---june-28" class="section level2">
<h2 class="hasAnchor">
<a href="#june-22---june-28" class="anchor"></a>June 22 - June 28</h2>
<div id="goals-6" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-6" class="anchor"></a>Goals</h3>
<p>This week is mostly about testing</p>
<p>My goals are to:</p>
<ul>
<li>Better understand Selenium/SauceLabs testing</li>
<li>Finish off little feature issues</li>
</ul>
</div>
<div id="quick-reflection-4" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-reflection-4" class="anchor"></a>Quick Reflection</h3>
<p>I felt much less productive this week than in previous weeks. A lot of the Selenium/web testing concepts are difficult and I got stuck/unmotivated at multiple points throughout the week. Still, I made some progress. I’ll plan to write a more extensive blog post about setting up RSelenium/SauceLabs towards the end of this internship period, so these are mostly notes to refresh my memory with that time comes.</p>
</div>
<div id="using-xpath-in-selenium" class="section level3">
<h3 class="hasAnchor">
<a href="#using-xpath-in-selenium" class="anchor"></a>Using XPath in Selenium</h3>
<p>Especially in a ShinyApp, many elements in the DOM can be difficult to find. For example: how do I access elements in a table from DataTables?</p>
<p>To make it easier to find elements in the DOM, Selenium allows elements to be specified by an “XML path”, or XPath.</p>
<p>XPath is super helpful and, luckily, RSelenium can take XPath parameters as arguments.</p>
<p>For more information on XPath, <a href="https://www.guru99.com/xpath-selenium.html">this tutorial is really helpful</a>.</p>
<p>But, in practice, I can generate the XPath I need using <a href="https://chrome.google.com/webstore/detail/katalon-recorder-selenium/ljdobmomdgdljniojadhoplhkpialdid?hl=en-US">Katalon Recorder Chrome extension</a>.</p>
<p>Katalon can recognize most of the elements in gfpopgui and give me the associated id or, if a simple id doesn’t exist, an XPath.</p>
<p>For example, the XPath of the first element in the first DataTable in gfpop gui is:</p>
<p><code>//table[@id='DataTables_Table_0']/tbody/tr/td[0]</code></p>
<p>So, to access that element with RSelenium, I can write:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">remDr</span>$<span class="fu">findElement</span>(<span class="st">"xpath"</span>, <span class="st">"//table[@id='DataTables_Table_0']/tbody/tr/td[0]"</span>)</pre></body></html></div>
<p>Or, if I want to recreate the entire DataTable:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu">data.table</span>(
    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(
            <span class="no">remDr</span>$<span class="fu">findElements</span>(<span class="st">"xpath"</span>, <span class="st">"//table[@id='DataTables_Table_0']/tbody/tr/td"</span>),
            <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">x</span>$<span class="fu">getElementAttribute</span>(<span class="st">"innerHTML"</span>))
            ),
        <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">10</span>,
        <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
)</pre></body></html></div>
</div>
<div id="reporting-build-status-with-rselenium" class="section level3">
<h3 class="hasAnchor">
<a href="#reporting-build-status-with-rselenium" class="anchor"></a>Reporting build status with RSelenium</h3>
<p>SauceLabs keeps track of all Selenium tests, but it doesn’t by default know whether these tests passed or failed.</p>
<p>To report pass/fail status, you need to explicitly send pass/fail flags through Selenium.</p>
<p>I couldn’t find any RSelenium-specific examples on how to send those flags, but I noticed that I could by sending Javascript snippets through RSelenium. For example, here’s a helper function that I made for annotating Selenium jobs:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">submit_job_info</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">remDr</span>, <span class="no">build</span>, <span class="no">name</span>, <span class="no">result</span>) {
  <span class="kw">if</span> (!(<span class="no">result</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"passed"</span>, <span class="st">"failed"</span>, <span class="st">"true"</span>, <span class="st">"false"</span>))) {
    <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"Invalid result. Please use: passed, failed, true, or false"</span>)
  }

  <span class="no">remDr</span>$<span class="fu">executeScript</span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sauce:job-build="</span>, <span class="no">build</span>))
  <span class="no">remDr</span>$<span class="fu">executeScript</span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sauce:job-name="</span>, <span class="no">name</span>))
  <span class="no">remDr</span>$<span class="fu">executeScript</span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"sauce:job-result="</span>, <span class="no">result</span>))

}</pre></body></html></div>
<p>Here’s how I would use that function in a testthat script:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">build_name</span> <span class="kw">&lt;-</span> <span class="no">buildName</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"my-test-build"</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"%m-%d-%Y_%s"</span>))

<span class="fu">test_that</span>(<span class="st">"1 equals 1"</span>, {
    <span class="no">remDr</span>$<span class="fu"><a href="https://rdrr.io/r/base/connections.html">open</a></span>(<span class="kw">silent</span><span class="kw">=</span><span class="no">T</span>)
    <span class="no">test_case</span> <span class="kw">&lt;-</span> <span class="fl">1</span><span class="kw">==</span><span class="fl">1</span>
    <span class="fu">submit_job_info</span>(<span class="kw">remDr</span> <span class="kw">=</span> <span class="no">remDr</span>, <span class="kw">build</span> <span class="kw">=</span> <span class="no">build_name</span>,
        <span class="kw">name</span> <span class="kw">=</span> <span class="st">"1 equals 1"</span>, <span class="kw">result</span> <span class="kw">=</span> <span class="no">test_case</span>)
    <span class="fu">expect_equal</span>(<span class="fl">1</span>, <span class="fl">1</span>)
    <span class="co"># I could also do `expect_true(test_case)`, but that gives less</span>
    <span class="co"># informative error messages</span>
})</pre></body></html></div>
<p>That way, SauceLabs will bundle together all tests that come from <code>build_name</code> (so, the current run of the tests) and it will let me know whether those tests passed or failed.</p>
</div>
<div id="local-testing-with-saucelabs" class="section level3">
<h3 class="hasAnchor">
<a href="#local-testing-with-saucelabs" class="anchor"></a>Local testing with SauceLabs</h3>
<p>Right now, all of my testing is done through the online shinyapps.io server.</p>
<p>Maybe that is the way I’ll end up doing all the testing, but I’m worried that testing will drain the alloted time on the free-tier shinyapps.io.</p>
<p>But, SauceLabs does have a mechanism to test locally-running applications. And it also supports running applications in the background on Travis, and then running SauceLabs/Selenium tests within Travis. That would be super nifty (this way, for example, I could test whether new functionality in the app passes integration tests <em>before</em> pushing deploying that new functionality).</p>
<p>The <a href="https://docs.ropensci.org/RSelenium/articles/saucelabs.html">RSelenium docs</a> have a guide to running tests like that. On my local computer, I installed the <a href="https://wiki.saucelabs.com/display/DOCS/Sauce+Connect+Proxy">Sauce Connect Proxy</a>, followed the setup instructions, and ran the proxy.</p>
<p>The RSelenium docs were a bit unclear on how to connect, but you create remoteDriver on port 80 pointing to <code>ondemand.saucelabs.com</code> with your normal account credentials. Since the Sauce Connect Proxy is also connected to your account, Saucelabs knows to connect any <code>localhost</code> URL requests to your local computer via the Sauce Connect Proxy tunnel. And, if you’re running through Travis, you need a seperate tunnel id that corresponds to the travis build id.</p>
<p>This seemed to connect appropriately, but I had a big problem interacting with the Shiny app this way: I would get a WebSocket-related error that prevented me from accessing the application. Evidently WebSocket compatability was a problem in the past (~2014), but those issues have been fixed. So, I put in a SauceLabs support ticket to see if they can help.</p>
<details><p><summary> Here’s the ticket that I submitted: </summary></p>
<p>Hi SauceLabs support,</p>
<p>I’m hoping to get some help connecting to a local application. I’m still very new to this, so hopefully I’m just overlooking something.</p>
<p>I’m running my app locally on port 3000. I’m also running Sauce Connect with <code>-B all</code> (see output below).</p>
<p>My application works as-expected locally. SauceLabs is also able to connect to the publicly-hosted version of the application.</p>
<p>However, SauceLabs cannot load the localhost:3000-hosted version of the application through the SauceConnect tunnel. The app loads briefly, then greys out.</p>
<p>In the JS Console, the application complains that a WebSocket connection to <a href="ws://localhost:3000/websocket" class="uri">ws://localhost:3000/websocket</a> had a 404 failure.</p>
<p>My application is made with R Shiny. John Harrison, who wrote the main R package for connecting to Selenium, had a similar WebSocket error in 2014. His issue seemed to have been resolved by <code>--vm-version dev-varnish</code> and/or <code>-B all</code>. But neither of those options resolve my issue.</p>
<p>A live test showing my issue can be found here: <a href="https://app.saucelabs.com/tests/394fa9bf14f24ddf8e50214ae91dd7b3#1" class="uri">https://app.saucelabs.com/tests/394fa9bf14f24ddf8e50214ae91dd7b3#1</a></p>
<p>SauceConnect seems to be working well. Output:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a><span class="ex">julian-ThinkPad-T460</span>:bin$ ./sc -u <span class="va">$SAUCE_USERNAME</span> -k <span class="va">$SAUCE_SECRET_KEY</span> -B all</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="ex">26</span> Jun 10:10:37 - Sauce Connect 4.6.2, build 5183 ad61662</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="ex">26</span> Jun 10:10:37 - REST: Using CA certificate bundle /etc/ssl/certs/ca-certificates.crt.</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="ex">26</span> Jun 10:10:37 - REST: Using CA certificate verify path /etc/ssl/certs.</span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="ex">26</span> Jun 10:10:37 - TUNNEL: Using CA certificate bundle /etc/ssl/certs/ca-certificates.crt.</span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="ex">26</span> Jun 10:10:37 - TUNNEL: Using CA certificate verify path /etc/ssl/certs.</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="ex">26</span> Jun 10:10:37 - Starting up<span class="kw">;</span> <span class="ex">pid</span> 1516379</span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="ex">26</span> Jun 10:10:37 - Command line arguments: ./sc -u julianstanley -k **** -B all</span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="ex">26</span> Jun 10:10:37 - Log file: /tmp/sc.log</span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="ex">26</span> Jun 10:10:37 - Pid file: /tmp/sc_client.pid</span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="ex">26</span> Jun 10:10:37 - Timezone: EDT GMT offset: -4h</span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="ex">26</span> Jun 10:10:37 - Using no proxy for connecting to Sauce Labs REST API.</span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="ex">26</span> Jun 10:10:37 - Started scproxy on port 40155.</span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="ex">26</span> Jun 10:10:37 - Please wait for <span class="st">'you may start your tests'</span> to start your tests.</span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="ex">26</span> Jun 10:10:50 - Secure remote tunnel VM provisioned.</span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="ex">26</span> Jun 10:10:50 - Tunnel ID: 4fbe703952fc48ac88e601734020edcb</span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="ex">26</span> Jun 10:10:51 - Starting OCSP certificate check.</span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="ex">26</span> Jun 10:10:51 - Using no proxy for connecting to http://status.geotrust.com.</span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="ex">26</span> Jun 10:10:51 - Using no proxy for connecting to http://ocsp.digicert.com.</span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="ex">26</span> Jun 10:10:51 - Reached a trusted CA. Certificate chain is verified.</span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="ex">26</span> Jun 10:10:51 - Using no proxy for connecting to tunnel VM.</span>
<span id="cb27-22"><a href="#cb27-22"></a><span class="ex">26</span> Jun 10:10:51 - Selenium listener disabled.</span>
<span id="cb27-23"><a href="#cb27-23"></a><span class="ex">26</span> Jun 10:10:51 - Establishing secure TLS connection to tunnel...</span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="ex">26</span> Jun 10:10:53 - Sauce Connect is up, you may start your tests.</span></code></pre></div>
<p>And the log seems to be showing the same as the console:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r">julian-ThinkPad-T460:~$ tail -100 /tmp/sc.log | grep localhost:3000 | grep socket -A10
2020-06-26 10:11:45.331 [1516379] PROXY 127.0.0.1:34558 (10.100.29.249) -&gt; GET http://localhost:3000/websocket/ (655 bytes)
2020-06-26 10:11:45.335 [1516379] PROXY 127.0.0.1:34558 (10.100.29.249) &lt;- 404 localhost:3000 (176 bytes)
2020-06-26 10:11:50.058 [1516379] PROXY 127.0.0.1:34568 (10.100.29.249) -&gt; GET http://localhost:3000/shared/shiny.min.js.map (548 bytes)
2020-06-26 10:11:50.071 [1516379] PROXY 127.0.0.1:34570 (10.100.29.249) -&gt; GET http://localhost:3000/shared/bootstrap/css/bootstrap.min.css.map (567 bytes)
2020-06-26 10:11:50.078 [1516379] PROXY 127.0.0.1:34568 (10.100.29.249) &lt;- 200 localhost:3000 (115012 bytes)
2020-06-26 10:11:50.087 [1516379] PROXY 127.0.0.1:34576 (10.100.29.249) -&gt; GET http://localhost:3000/crosstalk-1.1.0.1/js/crosstalk.min.js.map (566 bytes)
2020-06-26 10:11:50.097 [1516379] PROXY 127.0.0.1:34578 (10.100.29.249) -&gt; GET http://localhost:3000/vis-7.5.2/vis-network.min.js.map (557 bytes)
2020-06-26 10:11:50.102 [1516379] PROXY 127.0.0.1:34578 (10.100.29.249) &lt;- 404 localhost:3000 (116 bytes)
2020-06-26 10:11:50.107 [1516379] PROXY 127.0.0.1:34576 (10.100.29.249) &lt;- 200 localhost:3000 (50557 bytes)
2020-06-26 10:11:50.117 [1516379] PROXY 127.0.0.1:34570 (10.100.29.249) &lt;- 200 localhost:3000 (540654 bytes)</pre></body></html></div>
</details>
</div>
<div id="autodeployment-to-shinyapps-io" class="section level3">
<h3 class="hasAnchor">
<a href="#autodeployment-to-shinyapps-io" class="anchor"></a>Autodeployment to shinyapps.io</h3>
<p>On my todo list for a while has been continuously deploying the app to shinyapps.io via travis.</p>
<p>There were some weird things happening before. I think I’ve fixed those by just using <code>install_github('julianstanley/gfpop-gui')</code> <em>before</em> deploying, but after testing. Since the deployment only happens if the tests of the current build pass (and only on the master branch), then I can assume that the most up-to-date master branch is functional, install that, and use that up-to-date installation in the deployment.</p>
<p>Previously, I think I was using outdated versions of <code>gfpop-gui</code> in the deployment, which was causing the problems.</p>
<p>Right now deploying that way is putting the app at julianstanley.shinyapps.io/gfpop-gui instead of julianstanley.shinyapps.io/gfpopgui and I think that’s just because the github repository is <code>gfpop-gui</code> but the package name is <code>gfpopgui</code>. I need to pick one of these (the discrepency is there because <code>gfpop-gui</code> is not a valid R package name–they can’t have dashes).</p>
</div>
</div>
<div id="june-29---july-03" class="section level2">
<h2 class="hasAnchor">
<a href="#june-29---july-03" class="anchor"></a>June 29 - July 03</h2>
<div id="goals-7" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-7" class="anchor"></a>Goals</h3>
<ul>
<li>Clean up basic app functionality for the end of Phase 1.</li>
</ul>
</div>
<div id="adding-save-and-load-buttons" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-save-and-load-buttons" class="anchor"></a>Adding ‘Save’ and ‘Load’ buttons</h3>
<p>In <code>gfpop</code>, users should be able to save and load their analyses, complete with their graphical constraint and main <code>gfpop</code> parameters.</p>
<p>Implementing this at a basic level was fairly straightforward: when a user presses “save”, all inputs that are necessary to reproduce the analysis should be saved in a <code><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveValues.html">reactiveValues()</a></code> list, with some user-supplied identifier.</p>
<p>Then, users can choose from saved identifiers to re-load saved analyses.</p>
<p>Practically, it looks something like this:</p>
<div id="initalize-reactive-values-list" class="section level4">
<h4 class="hasAnchor">
<a href="#initalize-reactive-values-list" class="anchor"></a>Initalize reactive values list</h4>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">saved_analyses</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveValues.html">reactiveValues</a></span>(
    <span class="kw">saved_full</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(),
    <span class="kw">saved_descriptions</span> <span class="kw">=</span> <span class="fu">data.table</span>()
)</pre></body></html></div>
<p>The idea here is that this data structure allows for more complex saving implemtations as well, if we end up wanting that. <code>saved_full</code> saves <em>all</em> data associated with a given save point, whereas <code>saved_descriptions</code> is a table that describes each entry in <code>saved_full</code>.</p>
<p>In this implementation, <code>saved_descriptions</code> just has identifiers, but we could also add more identifying information if that ends up being useful.</p>
</div>
<div id="add-button-to-save" class="section level4">
<h4 class="hasAnchor">
<a href="#add-button-to-save" class="anchor"></a>Add button to save</h4>
<p>Here, I need to use <code>reactiveValuesToList</code> because, if I literally saved gfpop_data in its reactiveValue form, it would continue to update as inputs change. But I want to save a snapshot, so I save it as a list.</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"># In UI
h2("Save"),
textInput(
    inputId = ns("saveId"),
    label = "Unique Save Name"
),
actionButton(
    inputId = ns("saveButton"),
    label = "Save Analysis"
)

# In Server
observeEvent(input$saveButton, 
    req(input$saveId)
    saveId &lt;- input$saveId

    # Make sure the save id is unique!
    if (saveId %in% names(saved_analyses$saved_full)) {
        shinyalert(paste0(
        "Error: '", saveId,
        "' already exists.\nIDs must be unique."
        ))

    # The saveId should be the key for the saved_full list.
    # And, for now (as mentioned in text above), `saved_descriptions`
    # is just the id, but could be built up later if necessary
    } else {
        saved_analyses$saved_full[[saveId]] &lt;- reactiveValuesToList(gfpop_data)
        saved_analyses$saved_descriptions &lt;- rbind(
        saved_analyses$saved_descriptions,
        data.table(id = input$saveId)
        )
    }

    # Clear the text input after saving
    updateTextInput(session, "saveId", value = "")
    })</pre></body></html></div>
</div>
<div id="add-ui-element-with-a-list-of-saved-environments" class="section level4">
<h4 class="hasAnchor">
<a href="#add-ui-element-with-a-list-of-saved-environments" class="anchor"></a>Add UI element with a list of saved environments</h4>
<div class="sourceCode" id="cb31"><html><body><pre class="r"># In UI
h2("Load"),
uiOutput(ns("uiLoadId"))

# In Server
output$uiLoadId &lt;- renderUI({
selectInput(ns("loadId"), "Select a previous analysis",
    choices = saved_analyses$saved_descriptions$id
)
})</pre></body></html></div>
</div>
<div id="add-a-loading-button" class="section level4">
<h4 class="hasAnchor">
<a href="#add-a-loading-button" class="anchor"></a>Add a loading button</h4>
<p>This part was a little tricky. First, to load the saved analyses, I need to coerce them into a reactive object, since I used <code>reactiveValuesToList</code> when saving. Then, I need to use a <code>&lt;&lt;-</code> to assign <code>gfpop_data</code> globally, not just within the observeEvent. Then, I use <code>do.call</code> to make each component of the saved list reactive.</p>
<p>In addition, overwriting <code>gfpop_data</code> does not update the graph (since there’s a manual button to update that graph). So, I use <code>updateNumericInput</code> to manually refresh the graph.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># In UI</span>
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html">actionButton</a></span>(
        <span class="kw">inputId</span> <span class="kw">=</span> <span class="fu">ns</span>(<span class="st">"loadButton"</span>),
        <span class="kw">label</span> <span class="kw">=</span> <span class="st">"Load Analysis"</span>
    )

<span class="co"># In Server</span>
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">observeEvent</a></span>(<span class="no">input</span>$<span class="no">loadButton</span>, {
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/req.html">req</a></span>(<span class="no">input</span>$<span class="no">loadId</span>)
<span class="no">gfpop_data</span> <span class="kw">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="st">"reactiveValues"</span>, <span class="no">saved_analyses</span>$<span class="no">saved_full</span><span class="kw">[[</span><span class="no">input</span>$<span class="no">loadId</span>]])

<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/updateNumericInput.html">updateNumericInput</a></span>(
    <span class="kw">session</span> <span class="kw">=</span> <span class="no">session</span>, <span class="kw">inputId</span> <span class="kw">=</span> <span class="st">"graph_refresh_helper"</span>,
    <span class="kw">value</span> <span class="kw">=</span> <span class="no">input</span>$<span class="no">graph_refresh_helper</span> + <span class="fl">1</span>
)
})</pre></body></html></div>
<p>Now, all together, users can load and save data!</p>
</div>
</div>
<div id="downloading-and-loading--rdata" class="section level3">
<h3 class="hasAnchor">
<a href="#downloading-and-loading--rdata" class="anchor"></a>Downloading and loading .Rdata</h3>
<p>This is simple, but was tricky to figure out how to do in the first place.</p>
<p>I wanted users to be able to download and upload .Rdata files with complete analyses.</p>
<p>To upload:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"># input$completed_analysis is defined above, that's the input 
# where users can upload their .Rdata file
rdata_name &lt;- load(input$completed_analysis$datapath)

# Use mget to load rdata_name into a variable
gfpop_data_list &lt;- mget(rdata_name, environment())

# The .Rdata contains a list, so go over each element in that list
# and add it to `gfpop_data`
# Since gfpop_data is already defined as a reactiveValues object, no
# need to coerse list items into reactive values: shiny takes care of that.
lapply(names(gfpop_data_list[[1]]), 
           function(x) gfpop_data[[x]] &lt;- gfpop_data_list[[1]][[x]])
  })</pre></body></html></div>
<p>To download:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co"># Just save gfpop_data as a list</span>
<span class="no">output</span>$<span class="no">downloadData</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/downloadHandler.html">downloadHandler</a></span>(
    <span class="kw">filename</span> <span class="kw">=</span> <span class="kw">function</span>() <span class="st">"gfpopgui_data.Rdata"</span>,
    <span class="kw">content</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">file</span>) {
        <span class="no">gfpop_data_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveValuesToList.html">reactiveValuesToList</a></span>(<span class="no">gfpop_data</span>, <span class="kw">all.names</span><span class="kw">=</span><span class="no">T</span>)
        <span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">gfpop_data_list</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="no">file</span>)
    }
)</pre></body></html></div>
</div>
<div id="converting-a-graph-dataframe-to-r-code" class="section level3">
<h3 class="hasAnchor">
<a href="#converting-a-graph-dataframe-to-r-code" class="anchor"></a>Converting a graph dataframe to R code</h3>
<p>I still need to work on this more. For now, I just take each column in a gfpop graph dataframe and make it into an argument in the <code><a href="https://rdrr.io/pkg/gfpop/man/Edge.html">gfpop::Edge()</a></code> function.</p>
<p>This method works for most simple graphs, but doesn’t consider things like “Node” columns, etc.</p>
<p>So, to format an individual row in a graph dataframe:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co">#' Takes in a row from a graph dataframe, returns that row formatted as R code</span>
<span class="co">#' @param edge_df One row from a gfpop::graph() graph df, with column names</span>
<span class="co">#' @returns a string corresponding to the code that, when run, produces the </span>
<span class="co">#' given edge</span>
<span class="co">#' @examples </span>
<span class="co">#' graph &lt;- gfpop::graph(type = "std")</span>
<span class="co">#' format_edge(graph[1,])</span>
<span class="co">#' @export</span>
<span class="no">format_edge</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">edge_df</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"gfpop::Edge(state1 = '"</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"state1"</span>]], <span class="st">"'"</span>,
         <span class="st">", state2 = '"</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"state2"</span>]], <span class="st">"'"</span>,
         <span class="st">", type = '"</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"type"</span>]], <span class="st">"'"</span>,
         <span class="st">", gap = "</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"parameter"</span>]],
         <span class="st">", penalty = "</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"penalty"</span>]],
         <span class="st">", K = "</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"K"</span>]],
         <span class="st">", a = "</span>, <span class="no">edge_df</span><span class="kw">[[</span><span class="st">"a"</span>]],
         <span class="st">")"</span>)
}</pre></body></html></div>
<p>And then, to wrap each row together:</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="co">#' Takes in a graph dataframe, returns the graph formatted as R code</span>
<span class="co">#' @param graph A graph df, like that returned by gfpop::graph()</span>
<span class="co">#' @returns a string corresponding to the code that, when run, produces the</span>
<span class="co">#' given graph</span>
<span class="co">#' @examples </span>
<span class="co">#' graph &lt;- gfpop::graph(type = "std")</span>
<span class="co">#' graph_to_R_code(graph)</span>
<span class="co">#' @export</span>
<span class="no">graph_to_R_code</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">graph</span>) {
  <span class="no">valid_colnames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"state1"</span>, <span class="st">"state2"</span>,
                      <span class="st">"type"</span>, <span class="st">"parameter"</span>,
                      <span class="st">"penalty"</span>, <span class="st">"K"</span>, <span class="st">"a"</span>,
                      <span class="st">"min"</span>, <span class="st">"max"</span>)
  <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">graph</span>) <span class="kw">==</span> <span class="no">valid_colnames</span>)) {
    <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"Invalid column names. Is this a dataframe returned from gfpop::graph?"</span>)
  }

  <span class="no">return_command</span> <span class="kw">&lt;-</span> <span class="st">"gfpop::graph(\n"</span>

  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">graph</span>, <span class="fl">1</span>, <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="no">return_command</span> <span class="kw">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">return_command</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"    "</span>,
                                                     <span class="fu"><a href="../reference/format_edge.html">format_edge</a></span>(<span class="no">x</span>), <span class="st">",\n"</span>))
  })

  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="no">return_command</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(<span class="no">return_command</span>) - <span class="fl">2</span>), <span class="st">"\n)"</span>)
}</pre></body></html></div>
</div>
</div>
</div>
<div id="phase-2" class="section level1">
<h1 class="hasAnchor">
<a href="#phase-2" class="anchor"></a>Phase 2</h1>
<div id="july-04---july-12" class="section level2">
<h2 class="hasAnchor">
<a href="#july-04---july-12" class="anchor"></a>July 04 - July 12</h2>
<div id="goals-8" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-8" class="anchor"></a>Goals</h3>
<ul>
<li>Move more functionality to client-side</li>
<li>Continue moving forward with testing</li>
</ul>
</div>
<div id="using-custom-javascript-in-shinyapps" class="section level3">
<h3 class="hasAnchor">
<a href="#using-custom-javascript-in-shinyapps" class="anchor"></a>Using custom JavaScript in ShinyApps</h3>
<p>You can run custom JavaScript in a ShinyApp. This is fairly straightforward and there are some great resources available to learn more, such as <a href="http://connect.thinkr.fr/js4shinyfieldnotes">ThinkR’s JS4Shiny Field Notes</a> and the slides from the <a href="https://rstudio-conf-2020.github.io/js-for-shiny/">2020 RStudio conf JS For Shiny Workshop</a>.</p>
<div id="the-problem" class="section level4">
<h4 class="hasAnchor">
<a href="#the-problem" class="anchor"></a>The Problem</h4>
<p>Things get a little more complicated with htmlwidgets, the platform on which <code>visNetwork</code> is built.</p>
<p>JS code supplied to shiny runs when the DOM is first rendered. However, visNetwork is widget that doesn’t appear in the DOM until <em>after</em> the Shiny server renders it. Because of that, I couldn’t figure out how to add custom JS to the visNetwork widget.</p>
</div>
<div id="progress-towards-solution" class="section level4">
<h4 class="hasAnchor">
<a href="#progress-towards-solution" class="anchor"></a>Progress Towards Solution</h4>
<p>I posted related questions on <a href="https://community.rstudio.com/t/wait-for-an-object-to-be-rendered-before-adding-a-js-event-listener/72246">RStudio Community</a> and on <a href="https://stackoverflow.com/questions/62794827/r-shiny-run-js-after-htmlwidget-renders/62796035#62796035">StackOverflow</a>.</p>
<p>Stéphane Laurent gave a great answer where they introduced me to the <code><a href="https://rdrr.io/pkg/htmlwidgets/man/onRender.html">htmlwidgets::onRender()</a></code> function that is essentially designed for just this purpose: to add new javascript onto an existing HTMLwidget object.</p>
<p>So, I just add <code>%&gt;% onRender(additional_js)</code> to the visNetwork call, and then I can put custom javascript in an <code>additional_js</code> string.</p>
<p>I would like to learn how to move <code>additional_js</code> to a seperate file. This is straightforward when using a JS file in Shiny generally, but I’m not sure how to do that with <code>onRender()</code>.</p>
<p><code>onRender()</code> may help me implement a variety of features. In the meantime, I can use it to validate the entries that a user passes when editing an edge:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1"></a>additional_js <span class="op">&lt;-</span><span class="st">"function(el, x) {</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>    <span class="co">// Validate edge type when the save button is pressed</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="at">$</span>(<span class="st">'#editedge-saveButton'</span>).<span class="at">on</span>(<span class="st">'click'</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>        <span class="kw">let</span> type <span class="op">=</span> <span class="at">$</span>(<span class="st">'#editedge-type'</span>).<span class="at">val</span>()<span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>        <span class="cf">if</span> (<span class="op">!</span>[<span class="st">'null'</span><span class="op">,</span> <span class="st">'std'</span><span class="op">,</span> <span class="st">'up'</span><span class="op">,</span> <span class="st">'down'</span><span class="op">,</span> <span class="st">'abs'</span>].<span class="at">includes</span>(<span class="va">type</span>.<span class="at">toLowerCase</span>())) <span class="op">{</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>            <span class="at">alert</span>(<span class="vs">`</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> is not a valid type. Defaulting to null`</span>)<span class="op">;</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>            <span class="at">$</span>(<span class="st">'#editedge-type'</span>).<span class="at">val</span>(<span class="st">'null'</span>)<span class="op">;</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>        <span class="op">}</span></span>
<span id="cb37-9"><a href="#cb37-9"></a>    <span class="op">}</span>)</span>
<span id="cb37-10"><a href="#cb37-10"></a>}</span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="st">"</span></span></code></pre></div>
</div>
</div>
<div id="follow-up-on-the-saucelabs-local-testing-issue" class="section level3">
<h3 class="hasAnchor">
<a href="#follow-up-on-the-saucelabs-local-testing-issue" class="anchor"></a>Follow-up on the SauceLabs local testing issue</h3>
<p>After some back-and-forth with the SauceLabs folks, they figured out why I was <a href="https://julianstanley.github.io/gfpopgui/docs/timeline/Phase1/june22_june28#local-testing-with-saucelabs">having this problem that I described in more detail a few weeks ago</a>. Basically, it was because of the way that they proxy localhost requests. Their proxy makes it easier for people to connect on certain ports but, in this case, was blocking that WebSocket handshake.</p>
<p>So it ended up being an easy fix: I just added 127.0.0.1 julian.local to my /etc/hosts and then pointed Selenium to julian.local:3000 instead of localhost:3000. Bam, problem gone.</p>
<p>The problem I experienced seems to happen with every Shiny app, since they all rely on that handshake, but there’s no info about that anywhere. Later this week, I’m going to work on a blog post explaining using SauceLabs and Selenium with Shiny, so I’ll include more information about this there.</p>
</div>
</div>
<div id="july-13---july-19" class="section level2">
<h2 class="hasAnchor">
<a href="#july-13---july-19" class="anchor"></a>July 13 - July 19</h2>
<div id="goals-9" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-9" class="anchor"></a>Goals</h3>
<ul>
<li>Fix visNetwork refresh problem</li>
<li>Allow users to use start/end nodes</li>
<li>Fix bugs, build on existing features</li>
</ul>
</div>
<div id="fixing-the-visnetwork-graph-refresh-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#fixing-the-visnetwork-graph-refresh-problem" class="anchor"></a>Fixing the visNetwork graph refresh problem</h3>
<p>This was deceptively easy. I just needed to use the <code>visNetworkProxy</code> functionality. I had tried to do this before, but thought I was on the wrong path because of some small code bugs.</p>
<p>In short, if anyone is reading this and trying to resolve a similar problem, just look at the visNetwork example shiny application:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="kw pkg">shiny</span><span class="kw ns">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/runApp.html">runApp</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"shiny"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"visNetwork"</span>))</pre></body></html></div>
<p>Essentially, I previously re-generated the visNetwork plot at certain times. Now, instead of re-generating the visNetwork plot, I just call:</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu">visNetworkProxy</span>(<span class="fu">ns</span>(<span class="st">"gfpopGraph"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">visUpdateNodes</span>(<span class="kw">nodes</span> <span class="kw">=</span> <span class="no">gfpop_data</span>$<span class="no">graphdata_visNetwork</span>$<span class="no">nodes</span>) <span class="kw">%&gt;%</span>
    <span class="fu">visUpdateEdges</span>(<span class="kw">edges</span> <span class="kw">=</span> <span class="no">gfpop_data</span>$<span class="no">graphdata_visNetwork</span>$<span class="no">edges</span>)</pre></body></html></div>
<p>And visNetwork will update the graph without moving the nodes.</p>
</div>
<div id="setting-startingending-nodes" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-startingending-nodes" class="anchor"></a>Setting starting/ending nodes</h3>
<p>Users need to be able to pick <em>one</em> starting node, and one ending node.</p>
<p>They also need to be able to not pick a node at all. By default, all nodes should be able to be starting or ending nodes.</p>
<p>So, I created dropdown boxes with all current nodes, plus the string “N/A” that users can choose between to set the starting and ending nodes. For example:</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">output</span>$<span class="no">uiSetStart</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderUI.html">renderUI</a></span>({
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/selectInput.html">selectInput</a></span>(<span class="fu">ns</span>(<span class="st">"setStart"</span>), <span class="st">"Select a starting node"</span>,
    <span class="kw">choices</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"N/A"</span>,
    <span class="no">gfpop_data</span>$<span class="no">graphdata_visNetwork</span>$<span class="no">nodes</span>$<span class="no">label</span>
    ),
    <span class="kw">selected</span> <span class="kw">=</span> <span class="no">startEnd</span>$<span class="no">start</span>
)
})</pre></body></html></div>
<p>Notice that I set <code>selected = startEnd$start</code>. What was that about? The problem is that, each time the graphdata updates, the <code>setStart</code> selectInput will be refreshed. But, we want, for example, the starting node dropdown should have the current start node selected. So, I had to create a reactive value that holds the <em>current</em> starting node, and then have that value be the one that is selected in the dropdown.</p>
<p>Then, I use the value from the dropdown to set the starting node in the gfpop data:</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">observeEvent</a></span>(<span class="no">input</span>$<span class="no">setStartEnd_button</span>, {

    <span class="co"># new_val: the new start or new end</span>
    <span class="co"># val_type: "start" or "end"</span>
    <span class="no">set_startEnd</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">new_val</span>, <span class="no">val_type</span>) {
        <span class="kw">if</span> (<span class="no">new_val</span> <span class="kw">!=</span> <span class="st">"N/A"</span>) {
        <span class="no">gfpop_data</span>$<span class="no">graphdata</span> <span class="kw">&lt;&lt;-</span> <span class="kw pkg">gfpop</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gfpop/man/graph.html">graph</a></span>(
            <span class="no">gfpop_data</span>$<span class="no">graphdata</span> <span class="kw">%&gt;%</span>
            <span class="fu">rbind.fill</span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">state1</span> <span class="kw">=</span> <span class="no">new_val</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="no">val_type</span>))
        )
        } <span class="kw">else</span> {
        <span class="no">gfpop_data</span>$<span class="no">graphdata</span> <span class="kw">&lt;&lt;-</span> <span class="kw pkg">gfpop</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gfpop/man/graph.html">graph</a></span>(
            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">gfpop_data</span>$<span class="no">graphdata</span>) <span class="kw">%&gt;%</span>
            <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">type</span> <span class="kw">!=</span> <span class="no">val_type</span>)
        )
        }
    }

    <span class="fu">set_startEnd</span>(<span class="no">input</span>$<span class="no">setStart</span>, <span class="st">"start"</span>)
    <span class="fu">set_startEnd</span>(<span class="no">input</span>$<span class="no">setEnd</span>, <span class="st">"end"</span>)

    <span class="co"># Set these so that the "start" and "end" dropdown boxes, which are</span>
    <span class="co"># refreshed when graphdata updates, knows about the current start &amp; end</span>
    <span class="no">startEnd</span>$<span class="no">start</span> <span class="kw">&lt;-</span> <span class="no">input</span>$<span class="no">setStart</span>
    <span class="no">startEnd</span>$<span class="no">end</span> <span class="kw">&lt;-</span> <span class="no">input</span>$<span class="no">setEnd</span>

    <span class="co"># Update the visNetwork data to match the gfpop data</span>
    <span class="no">gfpop_data</span>$<span class="no">graphdata_visNetwork</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graphdf_to_visNetwork.html">graphdf_to_visNetwork</a></span>(
        <span class="no">gfpop_data</span>$<span class="no">graphdata</span>
    )
})</pre></body></html></div>
<p>So, modifying the ‘start’ node means adding a row to the gfpop dataframe. Once I do that, I need to (1) set the reactiveValues that indicate which node is start/end, and (2) update the visNetwork data to be consistent with the gfpop dataframe.</p>
</div>
<div id="common-error-over-isolating-inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#common-error-over-isolating-inputs" class="anchor"></a>Common error: over-isolating inputs</h3>
<p>Lots of errors have popped up while developing this application. One common error is that I tend to overuse the <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">shiny::isolate()</a></code> function.</p>
<p>The <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate()</a></code> function removes data from shiny’s reactive structure. So, for example, in this function:</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">output</span>$<span class="no">myOut</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html">renderPlot</a></span>(<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate</a></span>(<span class="no">input</span>$<span class="no">xmax</span>))</pre></body></html></div>
<p>The <code>myOut</code> plot will only update if I update it manually–unlike it’s counterpart without <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate()</a></code>, which would update each time <code>input$xmax</code> is updated.</p>
<p>This can be really handy for when outputs are computationally intensive to calculate. For example, I have the user press a “run gfpop” button whenever they want to run gfpop. Without <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate()</a></code>, the gfpop results would update each time an input was changed. And, if a user were changing lots of inputs, that might bog down the app unnecessarily.</p>
<p>But I have to be careful about using <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate()</a></code>. For example, when building the function that generates some data for gfpop, I initally used it in such a way that isolate was necessary, and it looked a bit like this:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r">primary_input &lt;- data.frame(
    X = 1:isolate(input$ndata)
    Y = dataGenerator(isolate(input$ndata),
    c(0.1, 0.3, 0.5, 0.8, 1), c(1, 2, 1, 3, 1), sigma = isolate(input$sigma))
    )

gfpop_data$main_data &lt;- primary_input</pre></body></html></div>
<p>I initally meant for this to be very temporary but, increasingly, I think a version of this generate data function needs to be in the final app for demonstration purposes.</p>
<p>So, when I put this into an observeEvent() call, it no longer needed the isolate calls, but I left them there anyways:</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r">observeEvent(input$genData, {
primary_input &lt;- data.frame(
    X = 1:isolate(input$ndata)
    Y = dataGenerator(isolate(input$ndata),
    c(0.1, 0.3, 0.5, 0.8, 1), c(1, 2, 1, 3, 1), sigma = isolate(input$sigma))
    )

gfpop_data$main_data &lt;- primary_input
})</pre></body></html></div>
<p>But, the <code><a href="https://shiny.rstudio.com/reference/shiny/latest/isolate.html">isolate()</a></code> calls here will prevent this expression from being run more than once! So, when I noticed that I couldn’t generate data more than once this week, I had to remove the isolate calls:</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r">observeEvent(input$genData, {
primary_input &lt;- data.frame(
    X = 1:input$ndata
    Y = dataGenerator(input$ndata,
    c(0.1, 0.3, 0.5, 0.8, 1), c(1, 2, 1, 3, 1), sigma = input$sigma)
    )

gfpop_data$main_data &lt;- primary_input
})</pre></body></html></div>
</div>
</div>
<div id="july-20---july-26" class="section level2">
<h2 class="hasAnchor">
<a href="#july-20---july-26" class="anchor"></a>July 20 - July 26</h2>
<div id="goals-10" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-10" class="anchor"></a>Goals</h3>
<ul>
<li>Implement crosstalk between visNetwork and plotly visualizations</li>
<li>Finish up smaller issues that have come up over the weeks</li>
</ul>
</div>
<div id="cross-talk-from-plotly-to-visnetwork" class="section level3">
<h3 class="hasAnchor">
<a href="#cross-talk-from-plotly-to-visnetwork" class="anchor"></a>Cross-talk from plotly to visNetwork</h3>
<p>When the user hovers over a changepoint segment in the plotly visualization, the associated node should be highlighted in the visNetwork (constraint graph) visualization.</p>
<p>If a plotly visualization includes a <code>key</code> attribute (e.g. <code>plot_ly(key = ~info)</code>), then that attribute is passed through the browser when the user hovers over a datapoint with that attribute.</p>
<p>That information can be observed through shiny via the <code>event_data()</code> plotly function.</p>
<p>For example, in my case, I observed <code>event_data("plotly_hover", "gfpopPlot")</code>, which returns a data table.</p>
<p>The return value from that observation is a table, and, when I gave each changeregion a <code>key</code> attribute with the id of of the changeregion’s state, that id is present in the “key” column of the data table, in the second row.</p>
<p>So, under certain conditions, I used <code>visNetworkProxy</code> to change the color of nodes that have the same id as the <code>key</code> of the selected change region.</p>
<p>For more information, see <a href="https://github.com/julianstanley/gfpopgui/commit/f1cc6204c5d03c8aa3d69c33377bf18fc50a4786">the associated commit</a>.</p>
</div>
<div id="cross-talk-from-visnetwork-to-plotly" class="section level3">
<h3 class="hasAnchor">
<a href="#cross-talk-from-visnetwork-to-plotly" class="anchor"></a>Cross-talk from visNetwork to plotly</h3>
<p>This was a little more difficult to me. The big problem here is that each changeregion is <em>not</em> a separate plotly trace, so I can’t change their colors individually.</p>
<p>I can make each changeregion a separate trace, but that makes the application a lot slower for many changeregions.</p>
<p>So, instead, I decided to “highlight” a changeregion by just drawing a <em>new</em> trace over the location of the associated changeregion.</p>
<p>This is definitely not fast, but I think it may be fast <em>enough</em> for our purposes.</p>
<p>To accomplish this, first I observe the <code>input$gfpopGraph_highlight_color_id</code> input. This comes from visNetwork (<code>gfpopGraph</code> is the id of the visNetwork visualization) and changes each time a node in the visNetwork plot is highlighted (which can happen on hover or on click). For now, I set this to on-click.</p>
<p>So, from that variable I know the ID of the node being highlighted. Then, I subset the changepoint information (on which the plotly graph was built) to only contain changeregions associated with the highlighted ID. Then, I use <code>plotlyProxy()</code> and <code>plotlyProxyInvoke("addTraces")</code> to make a new plotly trace. That trace can be later deleted with the <code>plotlyProxyInvoke("deleteTraces")</code> command.</p>
<p>For example:</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">highlighted_id</span> <span class="kw">&lt;-</span> <span class="no">input</span>$<span class="no">gfpopGraph_highlight_color_id</span>
<span class="no">segments_to_highlight</span> <span class="kw">&lt;-</span> <span class="no">gfpop_data</span>$<span class="no">changepoints</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">state</span> <span class="kw">==</span> <span class="no">highlighted_id</span>)

<span class="fu">plotlyProxy</span>(<span class="st">"gfpopPlot"</span>, <span class="no">session</span>) <span class="kw">%&gt;%</span>
    <span class="fu">plotlyProxyInvoke</span>(
        <span class="st">"addTraces"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
            <span class="kw">x</span> <span class="kw">=</span> <span class="no">segments_to_highlight</span>$<span class="no">x</span>,
            <span class="kw">y</span> <span class="kw">=</span> <span class="no">segments_to_highlight</span>$<span class="no">y</span>,
            <span class="kw">text</span> <span class="kw">=</span> <span class="no">segments_to_highlight</span>$<span class="no">text</span>,
            <span class="kw">line</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">10</span>)
        )
    )</pre></body></html></div>
<p>For more information, see the <a href="https://github.com/julianstanley/gfpopgui/commit/fe75aad7c0123c6b2bae9298adaf12aefab0a5f3">associated commit</a>.</p>
</div>
</div>
<div id="july-27---july-31" class="section level2">
<h2 class="hasAnchor">
<a href="#july-27---july-31" class="anchor"></a>July 27 - July 31</h2>
<div id="goals-11" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-11" class="anchor"></a>Goals</h3>
<ul>
<li>Write some more documentation</li>
<li>Test and optimize Phase 2 features</li>
</ul>
</div>
<div id="quick-logo-design" class="section level3">
<h3 class="hasAnchor">
<a href="#quick-logo-design" class="anchor"></a>Quick Logo Design</h3>
<p>I made a quick logo! Here it is:</p>
<p><img src="https://github.com/julianstanley/gfpopgui/raw/master/inst/docs/assets/readme_assets/gfpopgui_logo.png" alt="gfpopgui" width="200"></p>
<p>I made the top plot in <code>ggplot</code>, and then edited the colors with illustrator. I made the bottom graph first in visNetwork but, since visNetwork would only export non-vector images, I just drew it in illustrator.</p>
<p>Hopefully, it helps convey how gfpop is slightly different than other changepoint packages, like <code>changepoint</code>.</p>
<p>Conveniently, it also looks a bit like a face.</p>
</div>
<div id="data-table" class="section level3">
<h3 class="hasAnchor">
<a href="#data-table" class="anchor"></a>data.table</h3>
<p>I should have been using <code>data.table</code> from the start of this project. Not only is it much more efficient, it also makes filtering and mutating much easier.</p>
<p>For example, previously, I had to write a utility function to use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code>, but by a row condition instead of by column (see <code>mutate_cond</code> in the timeline entry from May 25th). But, with data.table, it’s super easy to mutate by a row condition. For example:</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r">&gt; dt &lt;- data.table(gfpop::graph(type = "updown"))
&gt; dt[state1 == "Up", penalty := 100]
&gt; dt
#    state1 state2 type parameter penalty   K a min max
# 1:     Dw     Dw null         1       0 Inf 0  NA  NA
# 2:     Up     Up null         1     100 Inf 0  NA  NA
# 3:     Dw     Up   up         0       0 Inf 0  NA  NA
# 4:     Up     Dw down         0     100 Inf 0  NA  NA</pre></body></html></div>
<p>It was a little more tricky for me to figure out how to mutate <em>multiple</em> columns at once like this.</p>
<p>For this, the <a href="https://atrebas.github.io/post/2019-03-03-datatable-dplyr/">data.table and dplyr tour page</a> was absolutely invaluable.</p>
<p>It didn’t have my exact case, but it showed me how to use <code>.()</code> to enclose multiple arguments. So, to mutate multiple columns, for example:</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r">&gt; dt &lt;- data.table(gfpop::graph(type = "updown"))
&gt; dt[state1 == "Up", c("penalty", "a") := .(100, 5)]
&gt; dt
#    state1 state2 type parameter penalty   K a min max
# 1:     Dw     Dw null         1       0 Inf 0  NA  NA
# 2:     Up     Up null         1     100 Inf 5  NA  NA
# 3:     Dw     Up   up         0       0 Inf 0  NA  NA
# 4:     Up     Dw down         0     100 Inf 5  NA  NA</pre></body></html></div>
</div>
<div id="r-cmd-check-and-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#r-cmd-check-and-documentation" class="anchor"></a>R CMD Check and Documentation</h3>
<p>I also made some small changes to make R CMD Check pass and to reformat the documentation.</p>
<p>For example, R CMD Check kept complaining that there was no visible definition for some of the variables I was using to subset and filter data.tables. This had happened previously with dplyr, and the solution was to import .data from rlang, and then use <code>.data$colname</code> instead of <code>colname</code>, for example.</p>
<p>I learned a more general solution <a href="https://github.com/Rdatatable/data.table/issues/850">in this thread</a>, which is to just assign those names to NULL at the top of a function definition. So, for example, if R CMD Check is complaining that <code>colname</code> is not defined, just set <code>colname &lt;- NULL</code> at the top of the function.</p>
<p>I also updated the documentation, switching from docusaurus to pkgdown (which is what you’re probably reading this on now). Docusaurus is great for large packages and complex documentation, but it seemed like too much overhead for my purposes with this package, so I just switched this timeline to a vignette.</p>
</div>
</div>
</div>
<div id="phase-3" class="section level1">
<h1 class="hasAnchor">
<a href="#phase-3" class="anchor"></a>Phase 3</h1>
<div id="august-01---august-09" class="section level2">
<h2 class="hasAnchor">
<a href="#august-01---august-09" class="anchor"></a>August 01 - August 09</h2>
<p>We’re in Phase 3 already! Time is weird.</p>
<p>Now, time to focus on writing more tests and ensuring that <code>gfpopgui</code> is as fast, stable, and useable as possible.</p>
<div id="goals-12" class="section level3">
<h3 class="hasAnchor">
<a href="#goals-12" class="anchor"></a>Goals</h3>
<ul>
<li>Write more testthat tests, modularizing as necessary</li>
<li>Write more Selenium tests</li>
<li>Write more vignettes, including a SauceLabs/Selenium one, opening issues as necessary</li>
<li>Fix bugs that come up while working on the three previous bullets</li>
</ul>
</div>
</div>
<div id="august-10---august-16" class="section level2">
<h2 class="hasAnchor">
<a href="#august-10---august-16" class="anchor"></a>August 10 - August 16</h2>
</div>
<div id="august-17---august-23" class="section level2">
<h2 class="hasAnchor">
<a href="#august-17---august-23" class="anchor"></a>August 17 - August 23</h2>
</div>
<div id="august-24---august-31" class="section level2">
<h2 class="hasAnchor">
<a href="#august-24---august-31" class="anchor"></a>August 24 - August 31</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Julian Stanley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
